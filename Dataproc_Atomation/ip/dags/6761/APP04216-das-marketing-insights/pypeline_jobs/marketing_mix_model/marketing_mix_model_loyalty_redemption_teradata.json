{
  "dag_id": "marketing_mix_model_loyalty_redemption_teradata",
  "dag_schedule": "00 12 * * 3",
  "dag_sla_minutes": "90",
  "prod_email_on_failure": "nap-marketing@nordstrom.pagerduty.com",
  "nonprod_email_on_failure": "varun.miranda@nordstrom.com",
  "dependencies": {
    "upstream": {
      "dags": [
        {
          "external_dag_id": "DAS_MARKETING_LOYALTY_NOTE",
          "external_task_id": "LOYALTY_NOTE_HDR_FACT_LD",
          "execution_delta": "timedelta(hours=-130)",
          "allowed_states": [
            "success"
          ],
          "failed_states": [
            "failed"
          ],
          "timeout": 7200,
          "poke_interval": 60
        }
      ]
    }
  },
  "stages": [
    "marketing_mix_model_loyalty_redemption"
  ],
  "dag_dynamic_vars": {
    "database_env": "eval('{\"nonprod\": \"PROTO_DSA_AI_DB\",\"test\": \"PROTO_DSA_AI_DB\", \"prod\": \"PRD_NAP_DSA_AI_STG\"}[env]')",
    "year": "eval('str(datetime.now().strftime(\"%Y\"))')",
    "month": "eval('str(datetime.now().strftime(\"%m\"))')",
    "day": "eval('str(datetime.now().strftime(\"%d\"))')"
  },
  "marketing_mix_model_loyalty_redemption": {
    "teradata_job": {
      "teradata_engine": {
        "input_details": [
          {
            "conn_name": "__MMM_TERADATA_STAGE__",
            "scripts": [
              "marketing_mix_model_loyalty_redemption_teradata.sql"
            ]
          }
        ]
      }
    },
    "job_export": {
      "tpt_engine": {
        "input_details": [
          {
            "conn_name": "__MMM_TPT_EXPORT__",
            "database_name": "?database_env?",
            "table_name": "MMM_LOYALTY_REDEMPTION_LDG",
            "s3_file_path": "s3://{mmm_s3_data_bucket}/Nordstrom/Outbound/delta_load/weekly_refresh/year=?year?/month=?month?/day=?day?/mmm_loyalty_redemption_export_?year?_?month?_?day?.csv",
            "sql_file_name": "marketing_mix_model_loyalty_redemption_tpt_export.sql",
            "text_delimiter_hexa_flag": "N",
            "text_delimiter": ",",
            "file_count": "1",
            "quoted_flag": "N",
            "quoted_data": "''"
          }
        ]
      }
    }
  }
}
