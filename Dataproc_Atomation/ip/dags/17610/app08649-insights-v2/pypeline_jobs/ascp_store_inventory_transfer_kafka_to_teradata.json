{
    "dag_id": "ascp_store_inventory_transfer_from_kafka_to_teradata",
    "dag_schedule": "0 8 * * *",
    "prod_email_on_failure": "nap-sco-high-pri@nordstrom.pagerduty.com",
    "nonprod_email_on_failure": "",
    "stages": [
        "store_inventory_transfer_load_v0"
    ],
    "store_inventory_transfer_load_v0": {
        "load_01_kafka": {
            "spark_engine": {
                "spark_run_mode": "low",
                "scripts": [
                    "ascp_store_inventory_transfer/read_store_inventory_transfer_from_kafka_to_teradata.sql"
                ],
                "input_details": [
                    {
                        "conn_name": "__KAFKA__",
                        "sql_table_reference": "kafka_inventory_store_inventory_transfer_object_model_avro",
                        "data_source_name": "inventory-store-transfer-lifecycle-analytical-avro"
                    },
                    {
                        "conn_name": "__S3_SINK_INVENTORY_SRC__",
                        "sql_table_reference": "orc_src",
                        "path": "s3://{s3_bucket_orc}/data/ascp-store-inventory-transfer-lifecycle-v1"
                    }
                ],
                "output_details": [
                    {
                        "conn_name": "__S3_SINK_INVENTORY_TMP__",
                        "sql_table_reference": "ascp-store-inventory-transfer-lifecycle-tmp"
                    },
                    {
                        "conn_name": "__S3_ERROR_SINK__",
                        "sql_table_reference": "store_inventory_transfer_receipt"
                    },
                    {
                        "conn_name": "__S3_ERROR_SINK__",
                        "sql_table_reference": "store_inventory_transfer_shipment"
                    },
                    {
                        "conn_name": "__S3_ERROR_SINK__",
                        "sql_table_reference": "store_inventory_transfer_created"
                    },
                    {
                        "conn_name": "__S3_ERROR_SINK__",
                        "sql_table_reference": "store_inventory_transfer_canceled"
                    },
                    {
                        "conn_name": "__TERADATA_NAP_STG__",
                        "sql_table_reference": "store_inventory_transfer_events_ldg_table",
                        "data_source_name": "STORE_INVENTORY_TRANSFER_EVENTS_LDG"
                    }
                ]
            }
        },
        "load_02_kafka": {
            "spark_engine": {
                "spark_run_mode": "low",
                "scripts": [
                    "ascp_store_inventory_transfer/read_store_inventory_allocation_from_kafka_to_teradata.sql"
                ],
                "input_details": [
                    {
                        "conn_name": "__KAFKA__",
                        "sql_table_reference": "kafka_inventory_store_inventory_allocation_object_model_avro",
                        "data_source_name": "inventory-store-allocation-lifecycle-analytical-avro"
                    },
                    {
                        "conn_name": "__S3_SINK_INVENTORY_SRC__",
                        "sql_table_reference": "orc_src",
                        "path": "s3://{s3_bucket_orc}/data/ascp-store-inventory-allocation-lifecycle-v1"
                    }
                ],
                "output_details": [
                    {
                        "conn_name": "__S3_SINK_INVENTORY_TMP__",
                        "sql_table_reference": "ascp-store-inventory-allocation-lifecycle-tmp"
                    },
                    {
                        "conn_name": "__S3_ERROR_SINK__",
                        "sql_table_reference": "store_inventory_transfer_allocation_receipt"
                    },
                    {
                        "conn_name": "__TERADATA_NAP_STG__",
                        "sql_table_reference": "store_inventory_transfer_allocation_receipt_ldg_table",
                        "data_source_name": "STORE_INVENTORY_TRANSFER_ALLOCATION_RECEIPT_LDG"
                    }
                ]
            }
        },
        "load_03_start_batch": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "__TERADATA_NAP_FCT__",
                        "scripts": [
                            "ascp_store_inventory_transfer/start_batch.sql"
                        ]
                    }
                ]
            }
        },
        "load_04_teradata": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "__TERADATA_NAP_FCT__",
                        "scripts": [
                            "ascp_store_inventory_transfer/store_inventory_transfer_initial_planning_load_fact_table.sql"
                        ]
                    }
                ]
            }
        },
        "load_05_teradata": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "__TERADATA_NAP_FCT__",
                        "scripts": [
                            "ascp_store_inventory_transfer/store_inventory_transfer_shipment_receipt_load_fact_table.sql"
                        ]
                    }
                ]
            }
        },
        "load_051_teradata_fact_dqc": {
            "teradata_engine": {
                "retries": 0,
                "input_details": [
                    {
                        "conn_name": "__TERADATA_NAP_FCT__",
                        "scripts": [
                            "ascp_store_inventory_transfer/td_fact_dqc.sql"
                        ]
                    }
                ]
            }
        },
        "load_06_end_batch": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "__TERADATA_NAP_FCT__",
                        "scripts": [
                            "ascp_store_inventory_transfer/end_batch.sql"
                        ]
                    }
                ]
            }
        },
        "load_transfer_orc_tgt_7": {
            "spark_engine": {
                "spark_run_mode": "low",
                "scripts": [
                    "ascp_store_inventory_transfer/store_inventory_transfer_orc_overwrite.sql"
                ],
                "input_details": [
                    {
                        "conn_name": "__S3_SINK_INVENTORY_SRC__",
                        "sql_table_reference": "orc_tmp",
                        "path": "s3://{s3_bucket_orc}/temporary/ascp-store-inventory-transfer-lifecycle-tmp"
                    }
                ],
                "output_details": [
                    {
                        "conn_name": "__S3_SINK_INVENTORY_TGT__",
                        "sql_table_reference": "ascp-store-inventory-transfer-lifecycle-v1"
                    }
                ]
            }
        },
        "load_allocation_orc_tgt_8": {
            "spark_engine": {
                "spark_run_mode": "low",
                "scripts": [
                    "ascp_store_inventory_transfer/store_inventory_allocation_orc_overwrite.sql"
                ],
                "input_details": [
                    {
                        "conn_name": "__S3_SINK_INVENTORY_SRC__",
                        "sql_table_reference": "orc_tmp",
                        "path": "s3://{s3_bucket_orc}/temporary/ascp-store-inventory-allocation-lifecycle-tmp"
                    }
                ],
                "output_details": [
                    {
                        "conn_name": "__S3_SINK_INVENTORY_TGT__",
                        "sql_table_reference": "ascp-store-inventory-allocation-lifecycle-v1"
                    }
                ]
            }
        }
    }
}