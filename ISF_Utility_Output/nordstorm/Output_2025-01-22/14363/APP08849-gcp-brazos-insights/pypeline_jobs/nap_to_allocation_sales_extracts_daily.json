{
    "dag_id": "nap_to_allocation_sales_extracts_daily",
    "dag_schedule": "50 03 * * 1-6",
    "timezone": "US/Pacific",
    "dependencies": {
        "upstream": {
            "dags": [
                {
                    "external_dag_id": "nap_to_allocation_454_calendar_extracts_daily_14363_?env?_brazos_brazos_dags",
                    "retries": 1,
                    "poke_interval": 60,
                    "timeout": 3600
                }
            ],
            "other_app_id": {
                "dags": [
                    {
                        "external_dag_id": "merch_allocation_fact_sku_store_load_10976_tech_nap_merch",
                        "conn_id": "OKTA_CONN_TO_APP04070",
                        "retries": 1,
                        "poke_interval": 120,
                        "timeout": 3600,
                        "python_query_code": "upstream_dependency.py",
                        "date_query_function_name": "upstream_dependency.date_query_function"
                    }
                ]
            }
        }
    },
    "dag_dynamic_vars": {
        "env": "eval('{\"nonprod\": \"dev\",\"test\": \"dev\", \"prod\": \"prod\"}[env]')"
    },
    "stages": [
        "nap_to_allocation",
        "extract_fp",
        "extract_op"
    ],
    "stage_dependencies": {
        "nap_to_allocation": [
            "extract_fp",
            "extract_op"
        ]
    },
    "nap_to_allocation": {
        "export_demand_fct": {
            "tpt_engine": {
                "input_details": [
                    {
                        "conn_name": "TPT_SOURCE",
                        "text_delimiter_hexa_flag": "'Y'",
                        "text_delimiter": "01",
                        "quoted_flag": "N",
                        "quoted_data": "''",
                        "database_name": "{db_env}_NAP_USR_VWS",
                        "table_name": "JWN_DEMAND_LIFECYCLE_FACT",
                        "s3_file_path": "s3://{tpt_bucket_name}/table_extracts/jwn_demand_lifecycle_fact/jwn_demand_lifecycle_fact.csv",
                        "sql_file_name": "demand_lifecycle_fact_export.sql"
                    }
                ],
                "output_details": []
            }
        },
        "export_inv_fct": {
            "tpt_engine": {
                "input_details": [
                    {
                        "conn_name": "TPT_SOURCE",
                        "text_delimiter_hexa_flag": "'Y'",
                        "text_delimiter": "01",
                        "quoted_flag": "N",
                        "quoted_data": "''",
                        "database_name": "{db_env}_NAP_USR_VWS",
                        "table_name": "INVENTORY_STOCK_QUANTITY_BY_DAY_LOGICAL_FACT",
                        "s3_file_path": "s3://{tpt_bucket_name}/table_extracts/inventory_stock_quantity_by_day_logical_fact/inventory_stock_quantity_by_day_logical_fact.csv",
                        "sql_file_name": "inventory_stock_quantity_by_day_logical_fact_export.sql"
                    }
                ],
                "output_details": []
            }
        },
        "export_sku_store_wrk": {
            "tpt_engine": {
                "input_details": [
                    {
                        "conn_name": "TPT_SOURCE",
                        "text_delimiter_hexa_flag": "'Y'",
                        "text_delimiter": "01",
                        "quoted_flag": "N",
                        "quoted_data": "''",
                        "database_name": "{db_env}_NAP_BASE_VWS",
                        "table_name": "MERCH_ALLOCATION_FACT_SKU_STORE_WRK",
                        "s3_file_path": "s3://{tpt_bucket_name}/table_extracts/merch_allocation_fact_sku_store_wrk/merch_allocation_fact_sku_store_wrk.csv",
                        "sql_file_name": "merch_allocation_fact_sku_store_wrk_export.sql"
                    }
                ],
                "output_details": []
            }
        }
    },
    "extract_fp": {
        "sales_fp_extracts": {
            "spark_engine": {
                "spark_run_mode": "high",
                "scripts": [
                    "nap_to_allocation_sales_fp_daily_extracts.sql"
                ],
                "input_details": [
                    {
                        "conn_name": "TERADATA_NAP_USR_VIEWS",
                        "sql_table_reference": "store_dim",
                        "data_source_name": "STORE_DIM"
                    },
                    {
                        "conn_name": "TERADATA_NAP_BASE_VIEWS",
                        "sql_table_reference": "etl_batch_dt_lkup",
                        "data_source_name": "ETL_BATCH_DT_LKUP"
                    }
                ],
                "output_details": [
                    {
                        "conn_name": "ALLOCATION_SALES_DAILY_FP_EXTRACTS_TAB",
                        "sql_table_reference": "sales_fp_tab"
                    },
                    {
                        "conn_name": "ALLOCATION_SALES_DAILY_FP_EXTRACTS_AUDIT",
                        "sql_table_reference": "sales_fp_audit"
                    }
                ]
            }
        }
    },
    "extract_op": {
        "sales_op_extracts": {
            "spark_engine": {
                "spark_run_mode": "high",
                "scripts": [
                    "nap_to_allocation_sales_op_daily_extracts.sql"
                ],
                "input_details": [
                    {
                        "conn_name": "TERADATA_NAP_USR_VIEWS",
                        "sql_table_reference": "store_dim",
                        "data_source_name": "STORE_DIM"
                    },
                    {
                        "conn_name": "TERADATA_NAP_BASE_VIEWS",
                        "sql_table_reference": "etl_batch_dt_lkup",
                        "data_source_name": "ETL_BATCH_DT_LKUP"
                    }
                ],
                "output_details": [
                    {
                        "conn_name": "ALLOCATION_SALES_DAILY_OP_EXTRACTS_TAB",
                        "sql_table_reference": "sales_op_tab"
                    },
                    {
                        "conn_name": "ALLOCATION_SALES_DAILY_OP_EXTRACTS_AUDIT",
                        "sql_table_reference": "sales_op_audit"
                    }
                ]
            }
        }
    }
}