{
    "dag_id": "affiliates_cost",
    "dag_schedule": "10 11 * * *",
    "dag_sla_minutes": "150",
    "prod_email_on_failure": "app08823-affiliates-cost@nordstrom.pagerduty.com",
    "nonprod_email_on_failure": "yesenia.garcia@nordstrom.com",
    "dependencies": {
        "upstream": {
            "dags": [
                {
                    "external_dag_id": "fp_funnel_cost_fact_11521_ACE_ENG",
                    "retries": 3,
                    "poke_interval": 120,
                    "timeout": 3600
                },
                {
                    "external_dag_id": "rack_funnel_cost_fact_11521_ACE_ENG",
                    "retries": 3,
                    "poke_interval": 120,
                    "timeout": 3600
                }
            ]
        }
    },
    "stages": [
        "campaign_cost_stage_0",
        "return_rate_stage_1",
        "cost_override_stage_2",
        "affiliates_cost_daily_fact_stage_3"
    ],
    "stage_dependencies": {
        "campaign_cost_stage_0": [
            "affiliates_cost_daily_fact_stage_3"
        ],
        "return_rate_stage_1": [
            "affiliates_cost_daily_fact_stage_3"
        ],
        "cost_override_stage_2": [
            "affiliates_cost_daily_fact_stage_3"
        ]
    },
    "sql_env_vars": {
        "start_date": "current_date()-60",
        "end_date": "current_date()-1"
    },
    "campaign_cost_stage_0": {
        "job_0": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "affiliates_cost/aff_camp_cost_tpt_job_insert.sql",
                            "affiliates_cost/ddl/ddl_affiliates_campaign_cost_ldg.sql"
                        ]
                    }
                ]
            }
        },
        "job_1": {
            "spark_engine": {
                "spark_run_mode": "medium",
                "retries": "0",
                "pause_idle_cluster_termination": "before_app",
                "scripts": [
                    "affiliates_cost/affiliates_campaign_cost_load.sql"
                ],
                "input_details": [],
                "output_details": [
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "affiliates_campaign_cost_ldg_output"
                    }
                ]
            }
        },
        "job_tpt": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "affiliates_campaign_cost_ldg",
                        "s3_file_path": "s3://{tpt_path}/affiliates_campaign_cost_ldg_output/*.csv.gz",
                        "job_name": "tpt_affiliates_campaign_cost_ldg"
                    }
                ],
                "output_details": []
            }
        },
        "job_2": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "affiliates_cost/affiliates_campaign_cost.sql"
                        ]
                    }
                ]
            }
        }
    },
    "return_rate_stage_1": {
        "job_0": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "affiliates_cost/aff_return_rate_tpt_job_insert.sql",
                            "affiliates_cost/ddl/ddl_affiliates_return_rate_ldg.sql"
                        ]
                    }
                ]
            }
        },
        "job_1": {
            "spark_engine": {
                "spark_run_mode": "medium",
                "retries": "0",
                "pause_idle_cluster_termination": "before_app",
                "scripts": [
                    "affiliates_cost/affiliates_return_rate_load.sql"
                ],
                "input_details": [],
                "output_details": [
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "affiliates_return_rate_ldg_output"
                    }
                ]
            }
        },
        "job_tpt": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "affiliates_return_rate_ldg",
                        "s3_file_path": "s3://{tpt_path}/affiliates_return_rate_ldg_output/*.csv.gz",
                        "job_name": "tpt_affiliates_return_rate_ldg"
                    }
                ],
                "output_details": []
            }
        },
        "job_2": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "affiliates_cost/affiliates_return_rate.sql"
                        ]
                    }
                ]
            }
        }
    },
    "cost_override_stage_2": {
        "job_0": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "affiliates_cost/aff_cost_override_tpt_job_insert.sql",
                            "affiliates_cost/ddl/ddl_affiliates_cost_override_ldg.sql"
                        ]
                    }
                ]
            }
        },
        "job_1": {
            "spark_engine": {
                "spark_run_mode": "medium",
                "retries": "0",
                "pause_idle_cluster_termination": "before_app",
                "scripts": [
                    "affiliates_cost/affiliates_cost_override_load.sql"
                ],
                "input_details": [],
                "output_details": [
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "affiliates_cost_override_ldg_output"
                    }
                ]
            }
        },
        "job_tpt": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "affiliates_cost_override_ldg",
                        "s3_file_path": "s3://{tpt_path}/affiliates_cost_override_ldg_output/*.csv.gz",
                        "job_name": "tpt_affiliates_cost_override_ldg"
                    }
                ],
                "output_details": []
            }
        },
        "job_2": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "affiliates_cost/affiliates_cost_override.sql"
                        ]
                    }
                ]
            }
        }
    },
    "affiliates_cost_daily_fact_stage_3": {
        "job_0_run_sql_to_update_t2_table": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "affiliates_cost/affiliates_cost_daily_fact.sql"
                        ]
                    }
                ]
            }
        }
    }
}