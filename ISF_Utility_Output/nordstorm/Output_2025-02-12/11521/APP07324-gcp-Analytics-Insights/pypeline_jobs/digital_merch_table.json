{
    "dag_id": "digital_merch_table",
    "dag_schedule": "0 16 * * *",
    "prod_email_on_failure": "cia-app09142-customer-and-merch-attributes-to-object@nordstrom.pagerduty.com, jingnan.miao@nordstrom.com, yan.zhang@nordstrom.com",
    "nonprod_email_on_failure": "jingnan.miao@nordstrom.com, yan.zhang@nordstrom.com",
    "dependencies": {
        "upstream": {
            "dags": [
                {
                    "external_dag_id": "digital_inventory_age_table_11521_ACE_ENG",
                    "retries": 3,
                    "poke_interval": 120,
                    "timeout": 3600
                }
            ]
        }
    },
    "stages": [
        "update_final_merch_table",
        "tpt_export",
        "create_as_is_merch_table"
    ],
    "sql_env_vars": {
        "start_date": "current_date()-1",
        "end_date": "current_date()-1"
    },
    "stage_dependencies": {
        "update_final_merch_table": [
            "tpt_export"
        ],
        "tpt_export": [
            "create_as_is_merch_table"
        ]
    },
    "update_final_merch_table": {
        "job_1_run_sql_to_update_t2_table": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_DMF",
                        "scripts": [
                            "digital_merch/digital_merch_table.sql"
                        ]
                    }
                ]
            }
        }
    },
    "tpt_export": {
        "job_2_tpt_export": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_DMF",
                        "table_name": "digital_merch_td_to_s3",
                        "s3_file_path": "s3://{s3_bucket_root_var}/tpt_export/digital_merch_td_to_s3.csv",
                        "sql_file_name": "digital_merch/tpt_export/digital_merch_td_to_s3.sql",
                        "text_delimiter_hexa_flag": "N",
                        "text_delimiter": ",",
                        "file_count": "1",
                        "quoted_flag": "Y",
                        "quoted_data": "'\\\"'"
                    }
                ],
                "output_details": []
            }
        },
        "job_3_load_to_hive": {
            "spark_engine": {
                "spark_run_mode": "medium",
                "retries": "0",
                "pause_idle_cluster_termination": "before_app",
                "scripts": [
                    "digital_merch/digital_merch_load.sql"
                ],
                "input_details": [],
                "output_details": []
            }
        }
    },
    "create_as_is_merch_table": {
        "job_1_run_sql": {
            "spark_engine": {
                "spark_run_mode": "medium",
                "retries": "0",
                "pause_idle_cluster_termination": "before_app",
                "scripts": [
                    "digital_merch/as_is_table/digital_merch_table_as_is.sql"
                ],
                "input_details": [],
                "output_details": []
            }
        }
    }
}