{
    "dag_id": "fp_funnel_cost_fact",
    "dag_schedule": "0 11 * * *",
    "dag_sla_minutes": "90",
    "nonprod_email_on_failure": "tamara.tangen@nordstrom.com",
    "prod_email_on_failure": "app08133-funnel-io-loads@nordstrom.pagerduty.com",
    "sql_env_vars": {
        "start_date": "current_date()-90",
        "end_date": "current_date()",
        "year": "202[3|4]"
    },
    "stages": [
        "fp_fcf_create_td_ldg_tables",
        "fp_fcf_load_to_csv",
        "fp_fcf_ldg_to_t2",
        "collect_stats",
        "tpt_load_fp_adwords_data_ldg",
        "tpt_load_fp_bing_data_ldg",
        "tpt_load_fp_facegram_data_ldg",
        "tpt_load_fp_gemini_data_ldg",
        "tpt_load_fp_oath_data_ldg",
        "tpt_load_fp_pinterest_data_ldg",
        "tpt_load_fp_rakuten_data_ldg",
        "tpt_load_fp_snapchat_data_ldg",
        "tpt_load_fp_tiktok_data_ldg",
        "tpt_load_fp_criteo_data_ldg",
        "tpt_load_fp_dv_three_sixty_data_ldg",
        "tpt_load_fp_google_ads_data_ldg",
        "tpt_load_nmn_fp_pinterest_data_ldg"
    ],
    "stage_dependencies": {
        "fp_fcf_create_td_ldg_tables": "fp_fcf_load_to_csv",
        "fp_fcf_load_to_csv": [
            "tpt_load_fp_adwords_data_ldg",
            "tpt_load_fp_bing_data_ldg",
            "tpt_load_fp_facegram_data_ldg",
            "tpt_load_fp_gemini_data_ldg",
            "tpt_load_fp_oath_data_ldg",
            "tpt_load_fp_pinterest_data_ldg",
            "tpt_load_fp_rakuten_data_ldg",
            "tpt_load_fp_snapchat_data_ldg",
            "tpt_load_fp_tiktok_data_ldg",
            "tpt_load_fp_criteo_data_ldg",
            "tpt_load_fp_dv_three_sixty_data_ldg",
            "tpt_load_fp_google_ads_data_ldg",
            "tpt_load_nmn_fp_pinterest_data_ldg"
        ],
        "tpt_load_fp_adwords_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_bing_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_facegram_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_gemini_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_oath_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_pinterest_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_rakuten_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_snapchat_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_tiktok_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_criteo_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_dv_three_sixty_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_fp_google_ads_data_ldg": "fp_fcf_ldg_to_t2",
        "tpt_load_nmn_fp_pinterest_data_ldg": "fp_fcf_ldg_to_t2",
        "fp_fcf_ldg_to_t2": "collect_stats"
    },
    "fp_fcf_create_td_ldg_tables": {
        "job_1_create_td_landing_tables": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "funnel_io/fp/fp_fcf_tpt_job_insert.sql",
                            "funnel_io/fp/ddl/ddl_fp_adwords_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_bing_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_facegram_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_gemini_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_oath_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_pinterest_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_rakuten_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_snapchat_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_tiktok_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_criteo_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_dv_three_sixty_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_google_ads_data_ldg.sql",
                            "funnel_io/fp/ddl/ddl_fp_pinterest_reach_and_freq_ldg.sql"
                        ]
                    }
                ]
            }
        }
    },
    "fp_fcf_load_to_csv": {
        "job_2_load_data_to_csv": {
            "spark_engine": {
                "spark_run_mode": "medium",
                "retries": "0",
                "pause_idle_cluster_termination": "before_app",
                "scripts": [
                    "funnel_io/fp/fp_adwords_data_ldg.sql",
                    "funnel_io/fp/fp_bing_data_ldg.sql",
                    "funnel_io/fp/fp_facegram_data_ldg.sql",
                    "funnel_io/fp/fp_gemini_data_ldg.sql",
                    "funnel_io/fp/fp_oath_data_ldg.sql",
                    "funnel_io/fp/fp_pinterest_data_ldg.sql",
                    "funnel_io/fp/fp_rakuten_data_ldg.sql",
                    "funnel_io/fp/fp_snapchat_data_ldg.sql",
                    "funnel_io/fp/fp_tiktok_data_ldg.sql",
                    "funnel_io/fp/fp_criteo_data_ldg.sql",
                    "funnel_io/fp/fp_dv_three_sixty_data_ldg.sql",
                    "funnel_io/fp/fp_google_ads_data_ldg.sql",
                    "funnel_io/fp/nmn_fp_pinterest_data_ldg.sql"
                ],
                "input_details": [],
                "output_details": [
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_adwords_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_bing_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_facegram_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_gemini_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_oath_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_pinterest_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_rakuten_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_snapchat_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_tiktok_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_criteo_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_dv_three_sixty_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "fp_google_ads_data_ldg_output"
                    },
                    {
                        "conn_name": "TPT_CSV_OUTPUT",
                        "sql_table_reference": "nmn_fp_pinterest_data_ldg_output"
                    }
                ]
            }
        }
    },
    "tpt_load_fp_adwords_data_ldg": {
        "tpt_fp_fcf_fp_adwords_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_adwords_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_adwords_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_adwords_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_bing_data_ldg": {
        "tpt_fp_fcf_fp_bing_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_bing_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_bing_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_bing_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_facegram_data_ldg": {
        "tpt_fp_fcf_fp_facegram_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_facegram_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_facegram_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_facegram_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_gemini_data_ldg": {
        "tpt_fp_fcf_fp_gemini_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_gemini_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_gemini_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_gemini_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_oath_data_ldg": {
        "tpt_fp_fcf_fp_oath_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_oath_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_oath_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_oath_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_pinterest_data_ldg": {
        "tpt_fp_fcf_fp_pinterest_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_pinterest_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_pinterest_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_pinterest_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_rakuten_data_ldg": {
        "tpt_fp_fcf_fp_rakuten_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_rakuten_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_rakuten_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_rakuten_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_snapchat_data_ldg": {
        "tpt_fp_fcf_fp_snapchat_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_snapchat_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_snapchat_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_snapchat_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_tiktok_data_ldg": {
        "tpt_fp_fcf_fp_tiktok_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_tiktok_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_tiktok_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_tiktok_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_criteo_data_ldg": {
        "tpt_fp_fcf_fp_criteo_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_criteo_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_criteo_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_criteo_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_dv_three_sixty_data_ldg": {
        "tpt_fp_fcf_fp_dv_three_sixty_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_dv_three_sixty_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_dv_three_sixty_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_dv_three_sixty_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_fp_google_ads_data_ldg": {
        "tpt_fp_fcf_fp_google_ads_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "fp_google_ads_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/fp_google_ads_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_fp_google_ads_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "tpt_load_nmn_fp_pinterest_data_ldg": {
        "tpt_fp_fcf_nmn_fp_pinterest_data_ldg": {
            "tpt_engine": {
                "retries": "0",
                "input_details": [
                    {
                        "conn_name": "TPT_FIO",
                        "delimiter": "1F",
                        "table_name": "nmn_fp_pinterest_data_ldg",
                        "s3_file_path": "s3://{tpt_path}/nmn_fp_pinterest_data_ldg_output/*.csv.gz",
                        "job_name": "fp_fcf_nmn_fp_pinterest_data_ldg"
                    }
                ],
                "output_details": []
            }
        }
    },
    "fp_fcf_ldg_to_t2": {
        "job_3_update_t2_tables_from_landing_table": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "funnel_io/fp/fp_adwords_data.sql",
                            "funnel_io/fp/fp_bing_data.sql",
                            "funnel_io/fp/fp_facegram_data.sql",
                            "funnel_io/fp/fp_gemini_data.sql",
                            "funnel_io/fp/fp_oath_data.sql",
                            "funnel_io/fp/fp_pinterest_data.sql",
                            "funnel_io/fp/fp_rakuten_data.sql",
                            "funnel_io/fp/fp_snapchat_data.sql",
                            "funnel_io/fp/fp_tiktok_data.sql",
                            "funnel_io/fp/fp_criteo_data.sql",
                            "funnel_io/fp/fp_dv_three_sixty_data.sql",
                            "funnel_io/fp/fp_google_ads_data.sql",
                            "funnel_io/fp/nmn_fp_pinterest_data.sql"
                        ]
                    }
                ]
            }
        }
    },
    "collect_stats": {
        "job_4_collect_stats": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "TERADATA_SOURCE_FIO",
                        "scripts": [
                            "funnel_io/fp/fp_funnel_io_statistics.sql"
                        ]
                    }
                ]
            }
        }
    }
}