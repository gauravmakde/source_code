-- mandatory Query Band part
SET QUERY_BAND = 'App_ID=app07420; DAG_ID=payment_auth_res_afterpay_id_teradata; Task_Name=teradata_stg_to_teradata_fct_job;' -- noqa
FOR SESSION VOLATILE;

END TRANSACTION;

--Delete if exist
DELETE FROM {db_env}_NAP_BASE_VWS.PAYMENT_AUTHORIZATION_RESULT_AFTERPAY_ID_FACT
WHERE
    AUTHORIZATION_RESULT_ID IN (SELECT AUTHORIZATION_RESULT_ID FROM {db_env}_NAP_STG.PAYMENT_AUTHORIZATION_RESULT_AFTERPAY_ID_LDG);

--Insert into the target table
INSERT INTO {db_env}_NAP_FCT.PAYMENT_AUTHORIZATION_RESULT_AFTERPAY_ID_FACT (
    AUTHORIZATION_RESULT_ID,
    BIN_TYPE
)
SELECT
    AUTHORIZATION_RESULT_ID,
    BIN_TYPE
FROM {db_env}_NAP_STG.PAYMENT_AUTHORIZATION_RESULT_AFTERPAY_ID_LDG;

-- Remove records from temporary tables
DELETE FROM {db_env}_NAP_STG.PAYMENT_AUTHORIZATION_RESULT_AFTERPAY_ID_LDG;

SET QUERY_BAND = NONE FOR SESSION; -- noqa

END TRANSACTION;
