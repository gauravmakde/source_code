{
    "dag_id": "marketing_mix_model_traffic_kpi_teradata",
    "dag_schedule": "00 12 * * 3",
    "dag_sla_minutes": "90",
    "prod_email_on_failure": "nap-marketing@nordstrom.pagerduty.com",
    "nonprod_email_on_failure": "yu-lin.chou@nordstrom.com",
    "dependencies": {
        "upstream": {
            "dags": [
                {
                    "external_dag_id": "DAS_MARKETING_LOYALTY_BENEFIT",
                    "external_task_id": "LOYALTY_LIFECYCLE_REWARDSLEVEL_LD",
                    "execution_delta": "timedelta(hours=-130)",
                    "allowed_states": [
                        "success"
                    ],
                    "failed_states": [
                        "failed"
                    ],
                    "timeout": 7200,
                    "poke_interval": 60
                }
            ],
            "other_app_id": {
                "dags": [
                    {
                        "external_dag_id": "DW_AARE_STATUS",
                        "conn_id": "okta_connection_app07575",
                        "upstream_lookback_days": 1,
                        "external_task_id": "CUSTOMER_NTN_STATUS_FACT_LD",
                        "allowed_states": [
                            "success"
                        ],
                        "failed_states": [
                            "failed"
                        ],
                        "timeout": 7200,
                        "poke_interval": 60
                    },
                    {
                        "external_dag_id": "PRODUCT_OBJECT_MODEL_TO_SEMANTIC_LOAD_V1",
                        "conn_id": "okta_connection_app08918",
                        "upstream_lookback_days": 1,
                        "external_task_id": "END_PRODUCT_LOAD",
                        "allowed_states": [
                            "success"
                        ],
                        "failed_states": [
                            "failed"
                        ],
                        "timeout": 7200,
                        "retries": 1,
                        "poke_interval": 60
                    },
                    {
                        "external_dag_id": "aec_audience_engagement_cohorts_11521_ACE_ENG",
                        "conn_id": "okta_connection_app07324",
                        "upstream_lookback_days": 1,
                        "external_task_id": "run_teradata_sql_stg_0_job_0_sensor",
                        "allowed_states": [
                            "success"
                        ],
                        "failed_states": [
                            "failed"
                        ],
                        "timeout": 7200,
                        "poke_interval": 60
                    },
                    {
                        "external_dag_id": "dior_sessions_11521_ACE_ENG",
                        "conn_id": "okta_connection_app07324",
                        "upstream_lookback_days": 1,
                        "external_task_id": "trigger_dag_refresh_digital_funnel_sessions_11521_ACE_ENG",
                        "allowed_states": [
                            "success"
                        ],
                        "failed_states": [
                            "failed"
                        ],
                        "timeout": 7200,
                        "poke_interval": 60
                    },
                    {
                        "external_dag_id": "store_traffic_daily_11521_ACE_ENG",
                        "conn_id": "okta_connection_app07324",
                        "upstream_lookback_days": 1,
                        "external_task_id": "trigger_dag_mothership_clarity_finance_sales_demand_margin_traffic_fact_11521_ACE_ENG",
                        "allowed_states": [
                            "success"
                        ],
                        "failed_states": [
                            "failed"
                        ],
                        "timeout": 7200,
                        "poke_interval": 60
                    },
                    {
                        "external_dag_id": "demand_and_op_gmv",
                        "conn_id": "okta_connection_app08619",
                        "upstream_lookback_days": 1,
                        "external_task_id": "views_end",
                        "allowed_states": [
                            "success"
                        ],
                        "failed_states": [
                            "failed"
                        ],
                        "timeout": 7200,
                        "poke_interval": 60
                    }
                ]
            }
        }
    },
    "stages": [
        "marketing_mix_model_traffic_kpi"
    ],
    "dag_dynamic_vars": {
        "database_env": "eval('{\"nonprod\": \"PROTO_DSA_AI_DB\",\"test\": \"PROTO_DSA_AI_DB\", \"prod\": \"PRD_NAP_DSA_AI_STG\"}[env]')",
        "year": "eval('str(datetime.now().strftime(\"%Y\"))')",
        "month": "eval('str(datetime.now().strftime(\"%m\"))')",
        "day": "eval('str(datetime.now().strftime(\"%d\"))')"
    },
    "marketing_mix_model_traffic_kpi": {
        "teradata_job": {
            "teradata_engine": {
                "input_details": [
                    {
                        "conn_name": "__MMM_TERADATA_STAGE__",
                        "scripts": [
                            "marketing_mix_model_traffic_kpi_teradata_sql.sql"
                        ]
                    }
                ]
            }
        },
        "job_export": {
            "tpt_engine": {
                "input_details": [
                    {
                        "conn_name": "__MMM_TPT_EXPORT__",
                        "database_name": "?database_env?",
                        "table_name": "MMM_TRAFFIC_KPI_LDG",
                        "s3_file_path": "s3://{mmm_s3_data_bucket}/Nordstrom/Outbound/delta_load/weekly_refresh/year=?year?/month=?month?/day=?day?/mmm_traffic_kpi_export_?year?_?month?_?day?.csv",
                        "sql_file_name": "marketing_mix_model_traffic_kpi_tpt_export.sql",
                        "text_delimiter_hexa_flag": "N",
                        "text_delimiter": ",",
                        "file_count": "1",
                        "quoted_flag": "N",
                        "quoted_data": "''"
                    }
                ]
            }
        }
    }
}