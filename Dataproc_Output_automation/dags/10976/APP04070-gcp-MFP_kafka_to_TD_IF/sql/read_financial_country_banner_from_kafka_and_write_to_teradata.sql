SET QUERY_BAND = '
App_ID=APP04070;
DAG_ID=mfpc_financial_country_banner_kafka_to_teradata_v4;
Task_Name=job_financial_country_banner_first_exec_002;'
FOR SESSION VOLATILE;

--Source
--Reading Data from  Source Kafka Topic Name=inventory-financial-country-banner-level-plans-approved-analytical-avro
--using SQL API CODE
create temporary view temp_financial_country_banner_object_model AS select * from kafka_financial_country_banner_object_model_avro;
--Transform Logic
--Extracting Required Column from Kafka (Cache in previous SQL)

create temporary view kafka_financial_country_banner_object_model_avro_extract_array as
select sourcepublishtime as SOURCE_PUBLISH_TIME,
approvedtime as APPROVED_TIME,
weekid as WEEK_ID,
departmentnumber as DEPARTMENT_NUMBER,
channelcountry as CHANNEL_COUNTRY,
pricingchannel as PRICING_CHANNEL,
element_at(headers,'LastUpdatedTime') as LAST_UPDATED_TIME_IN_MILLIS,
explode(countrybannerplandetails) as countryBannerPlanDetails
from temp_financial_country_banner_object_model;

create temporary view kafka_financial_country_banner_object_model_avro_extract_columns_channel as
select
SOURCE_PUBLISH_TIME as SOURCE_PUBLISH_TIME,
APPROVED_TIME as APPROVED_TIME,
WEEK_ID as WEEK_ID,
DEPARTMENT_NUMBER as DEPARTMENT_NUMBER,
CHANNEL_COUNTRY as CHANNEL_COUNTRY,
PRICING_CHANNEL as PRICING_CHANNEL,
LAST_UPDATED_TIME_IN_MILLIS as LAST_UPDATED_TIME_IN_MILLIS,
countryBannerPlanDetails.financialplanversion as FINANCIAL_PLAN_VERSION,
explode(countryBannerPlanDetails.financialplandetails) as financialPlanDetails
from kafka_financial_country_banner_object_model_avro_extract_array;

create temporary view kafka_financial_country_banner_object_model_avro_extract_columns as
select
SOURCE_PUBLISH_TIME as SOURCE_PUBLISH_TIME,
APPROVED_TIME as APPROVED_TIME,
WEEK_ID as WEEK_ID,
DEPARTMENT_NUMBER as DEPARTMENT_NUMBER,
CHANNEL_COUNTRY as CHANNEL_COUNTRY,
PRICING_CHANNEL as PRICING_CHANNEL,
LAST_UPDATED_TIME_IN_MILLIS as LAST_UPDATED_TIME_IN_MILLIS,
FINANCIAL_PLAN_VERSION as FINANCIAL_PLAN_VERSION,
financialPlanDetails.alternateinventorymodel as ALTERNATE_INVENTORY_MODEL,
financialPlanDetails.activebeginninginventory.dollars.currencycode as ACTIVE_BEGINNING_INVENTORY_DOLLAR_CURRENCY_CODE,
financialPlanDetails.activebeginninginventory.dollars.units as ACTIVE_BEGINNING_INVENTORY_DOLLAR_UNITS,
financialPlanDetails.activebeginninginventory.dollars.nanos as ACTIVE_BEGINNING_INVENTORY_DOLLAR_NANOS,
financialPlanDetails.activebeginninginventory.units as ACTIVE_BEGINNING_INVENTORY_UNITS,
financialPlanDetails.activebeginningofperiodinventorytargetunits as ACTIVE_BEGINNING_PERIOD_INVENTORY_TARGET_UNITS,
financialPlanDetails.inactivebeginningofperiodinventory.dollars.currencycode as INACTIVE_BEGINNING_PERIOD_INVENTORY_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inactivebeginningofperiodinventory.dollars.units as INACTIVE_BEGINNING_PERIOD_INVENTORY_DOLLAR_UNITS,
financialPlanDetails.inactivebeginningofperiodinventory.dollars.nanos as INACTIVE_BEGINNING_PERIOD_INVENTORY_DOLLAR_NANOS,
financialPlanDetails.inactivebeginningofperiodinventory.units as INACTIVE_BEGINNING_PERIOD_INVENTORY_UNITS,
financialPlanDetails.discounttermscost.currencycode as DISCOUNT_TERMS_COST_CURRENCY_CODE,
financialPlanDetails.discounttermscost.units as DISCOUNT_TERMS_COST_UNITS,
financialPlanDetails.discounttermscost.nanos as DISCOUNT_TERMS_COST_NANOS,
financialPlanDetails.activeendinginventory.dollars.currencycode as ACTIVE_ENDING_INVENTORY_DOLLAR_CURRENCY_CODE,
financialPlanDetails.activeendinginventory.dollars.units as ACTIVE_ENDING_INVENTORY_DOLLAR_UNITS,
financialPlanDetails.activeendinginventory.dollars.nanos as ACTIVE_ENDING_INVENTORY_DOLLAR_NANOS,
financialPlanDetails.activeendinginventory.units as ACTIVE_ENDING_INVENTORY_UNITS,
financialPlanDetails.inactiveendinginventory.dollars.currencycode as INACTIVE_ENDING_INVENTORY_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inactiveendinginventory.dollars.units as INACTIVE_ENDING_INVENTORY_DOLLAR_UNITS,
financialPlanDetails.inactiveendinginventory.dollars.nanos as INACTIVE_ENDING_INVENTORY_DOLLAR_NANOS,
financialPlanDetails.inactiveendinginventory.units as INACTIVE_ENDING_INVENTORY_UNITS,
financialPlanDetails.activeinventoryin.dollars.currencycode as ACTIVE_INVENTORY_IN_DOLLAR_CURRENCY_CODE,
financialPlanDetails.activeinventoryin.dollars.units as ACTIVE_INVENTORY_IN_DOLLAR_UNITS,
financialPlanDetails.activeinventoryin.dollars.nanos as ACTIVE_INVENTORY_IN_DOLLAR_NANOS,
financialPlanDetails.activeinventoryin.units as ACTIVE_INVENTORY_IN_UNITS,
financialPlanDetails.activeinventoryout.dollars.currencycode as ACTIVE_INVENTORY_OUT_DOLLAR_CURRENCY_CODE,
financialPlanDetails.activeinventoryout.dollars.units as ACTIVE_INVENTORY_OUT_DOLLAR_UNITS,
financialPlanDetails.activeinventoryout.dollars.nanos as ACTIVE_INVENTORY_OUT_DOLLAR_NANOS,
financialPlanDetails.activeinventoryout.units as ACTIVE_INVENTORY_OUT_UNITS,
financialPlanDetails.inactiveinventoryin.dollars.currencycode as INACTIVE_INVENTORY_IN_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inactiveinventoryin.dollars.units as INACTIVE_INVENTORY_IN_DOLLAR_UNITS,
financialPlanDetails.inactiveinventoryin.dollars.nanos as INACTIVE_INVENTORY_IN_DOLLAR_NANOS,
financialPlanDetails.inactiveinventoryin.units as INACTIVE_INVENTORY_IN_UNITS,
financialPlanDetails.inactiveinventoryout.dollars.currencycode as INACTIVE_INVENTORY_OUT_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inactiveinventoryout.dollars.units as INACTIVE_INVENTORY_OUT_DOLLAR_UNITS,
financialPlanDetails.inactiveinventoryout.dollars.nanos as INACTIVE_INVENTORY_OUT_DOLLAR_NANOS,
financialPlanDetails.inactiveinventoryout.units as INACTIVE_INVENTORY_OUT_UNITS,
financialPlanDetails.otherinventoryin.dollars.currencycode as OTHER_INVENTORY_IN_DOLLAR_CURRENCY_CODE,
financialPlanDetails.otherinventoryin.dollars.units as OTHER_INVENTORY_IN_DOLLAR_UNITS,
financialPlanDetails.otherinventoryin.dollars.nanos as OTHER_INVENTORY_IN_DOLLAR_NANOS,
financialPlanDetails.otherinventoryin.units as OTHER_INVENTORY_IN_UNITS,
financialPlanDetails.otherinventoryout.dollars.currencycode as OTHER_INVENTORY_OUT_DOLLAR_CURRENCY_CODE,
financialPlanDetails.otherinventoryout.dollars.units as OTHER_INVENTORY_OUT_DOLLAR_UNITS,
financialPlanDetails.otherinventoryout.dollars.nanos as OTHER_INVENTORY_OUT_DOLLAR_NANOS,
financialPlanDetails.otherinventoryout.units as OTHER_INVENTORY_OUT_UNITS,
financialPlanDetails.rackingin.dollars.currencycode as RACKING_IN_DOLLAR_CURRENCY_CODE,
financialPlanDetails.rackingin.dollars.units as RACKING_IN_DOLLAR_UNITS,
financialPlanDetails.rackingin.dollars.nanos as RACKING_IN_DOLLAR_NANOS,
financialPlanDetails.rackingin.units as RACKING_IN_UNITS,
financialPlanDetails.rackingout.dollars.currencycode as RACKING_OUT_DOLLAR_CURRENCY_CODE,
financialPlanDetails.rackingout.dollars.units as RACKING_OUT_DOLLAR_UNITS,
financialPlanDetails.rackingout.dollars.nanos as RACKING_OUT_DOLLAR_NANOS,
financialPlanDetails.rackingout.units as RACKING_OUT_UNITS,
financialPlanDetails.merchmarginretail.currencycode as MERCH_MARGIN_RETAIL_CURRENCY_CODE,
financialPlanDetails.merchmarginretail.units as MERCH_MARGIN_RETAIL_UNITS,
financialPlanDetails.merchmarginretail.nanos as MERCH_MARGIN_RETAIL_NANOS,
financialPlanDetails.activemarkoutofstock.dollars.currencycode as ACTIVE_MOS_DOLLAR_CURRENCY_CODE,
financialPlanDetails.activemarkoutofstock.dollars.units as ACTIVE_MOS_DOLLAR_UNITS,
financialPlanDetails.activemarkoutofstock.dollars.nanos as ACTIVE_MOS_DOLLAR_NANOS,
financialPlanDetails.activemarkoutofstock.units as ACTIVE_MOS_UNITS,
financialPlanDetails.inactivemarkoutofstock.dollars.currencycode as INACTIVE_MOS_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inactivemarkoutofstock.dollars.units as INACTIVE_MOS_DOLLAR_UNITS,
financialPlanDetails.inactivemarkoutofstock.dollars.nanos as INACTIVE_MOS_DOLLAR_NANOS,
financialPlanDetails.inactivemarkoutofstock.units as INACTIVE_MOS_UNITS,
financialPlanDetails.activereceipts.dollars.currencycode as ACTIVE_RECEIPTS_DOLLAR_CURRENCY_CODE,
financialPlanDetails.activereceipts.dollars.units as ACTIVE_RECEIPTS_DOLLAR_UNITS,
financialPlanDetails.activereceipts.dollars.nanos as ACTIVE_RECEIPTS_DOLLAR_NANOS,
financialPlanDetails.activereceipts.units as ACTIVE_RECEIPTS_UNITS,
financialPlanDetails.inactivereceipts.dollars.currencycode as INACTIVE_RECEIPTS_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inactivereceipts.dollars.units as INACTIVE_RECEIPTS_DOLLAR_UNITS,
financialPlanDetails.inactivereceipts.dollars.nanos as INACTIVE_RECEIPTS_DOLLAR_NANOS,
financialPlanDetails.inactivereceipts.units as INACTIVE_RECEIPTS_UNITS,
financialPlanDetails.reservereceipts.dollars.currencycode as RESERVE_RECEIPTS_DOLLAR_CURRENCY_CODE,
financialPlanDetails.reservereceipts.dollars.units as RESERVE_RECEIPTS_DOLLAR_UNITS,
financialPlanDetails.reservereceipts.dollars.nanos as RESERVE_RECEIPTS_DOLLAR_NANOS,
financialPlanDetails.reservereceipts.units as RESERVE_RECEIPTS_UNITS,
financialPlanDetails.reclassin.dollars.currencycode as RECLASS_IN_DOLLAR_CURRENCY_CODE,
financialPlanDetails.reclassin.dollars.units as RECLASS_IN_DOLLAR_UNITS,
financialPlanDetails.reclassin.dollars.nanos as RECLASS_IN_DOLLAR_NANOS,
financialPlanDetails.reclassin.units as RECLASS_IN_UNITS,
financialPlanDetails.reclassout.dollars.currencycode as RECLASS_OUT_DOLLAR_CURRENCY_CODE,
financialPlanDetails.reclassout.dollars.units as RECLASS_OUT_DOLLAR_UNITS,
financialPlanDetails.reclassout.dollars.nanos as RECLASS_OUT_DOLLAR_NANOS,
financialPlanDetails.reclassout.units as RECLASS_OUT_UNITS,
financialPlanDetails.activereturntovendor.dollars.currencycode as ACTIVE_RTV_DOLLAR_CURRENCY_CODE,
financialPlanDetails.activereturntovendor.dollars.units as ACTIVE_RTV_DOLLAR_UNITS,
financialPlanDetails.activereturntovendor.dollars.nanos as ACTIVE_RTV_DOLLAR_NANOS,
financialPlanDetails.activereturntovendor.units as ACTIVE_RTV_UNITS,
financialPlanDetails.inactiveretruntovendor.dollars.currencycode as INACTIVE_RTV_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inactiveretruntovendor.dollars.units as INACTIVE_RTV_DOLLAR_UNITS,
financialPlanDetails.inactiveretruntovendor.dollars.nanos as INACTIVE_RTV_DOLLAR_NANOS,
financialPlanDetails.inactiveretruntovendor.units as INACTIVE_RTV_UNITS,
financialPlanDetails.vendorfundscost.currencycode as VENDOR_FUNDS_COST_CURRENCY_CODE,
financialPlanDetails.vendorfundscost.units as VENDOR_FUNDS_COST_UNITS,
financialPlanDetails.vendorfundscost.nanos as VENDOR_FUNDS_COST_NANOS,
financialPlanDetails.inventorymovementdropshipin.dollars.currencycode as INVENTORY_MOVEMENT_DROP_SHIP_IN_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inventorymovementdropshipin.dollars.units as INVENTORY_MOVEMENT_DROP_SHIP_IN_DOLLAR_UNITS,
financialPlanDetails.inventorymovementdropshipin.dollars.nanos as INVENTORY_MOVEMENT_DROP_SHIP_IN_DOLLAR_NANOS,
financialPlanDetails.inventorymovementdropshipin.units as INVENTORY_MOVEMENT_DROP_SHIP_IN_UNITS,
financialPlanDetails.inventorymovementdropshipout.dollars.currencycode as INVENTORY_MOVEMENT_DROP_SHIP_OUT_DOLLAR_CURRENCY_CODE,
financialPlanDetails.inventorymovementdropshipout.dollars.units as INVENTORY_MOVEMENT_DROP_SHIP_OUT_DOLLAR_UNITS,
financialPlanDetails.inventorymovementdropshipout.dollars.nanos as INVENTORY_MOVEMENT_DROP_SHIP_OUT_DOLLAR_NANOS,
financialPlanDetails.inventorymovementdropshipout.units as INVENTORY_MOVEMENT_DROP_SHIP_OUT_UNITS,
financialPlanDetails.otherinventoryadjustments.dollars.currencycode as OTHER_INVENTORY_ADJUSTMENTS_DOLLAR_CURRENCY_CODE,
financialPlanDetails.otherinventoryadjustments.dollars.units as OTHER_INVENTORY_ADJUSTMENTS_DOLLAR_UNITS,
financialPlanDetails.otherinventoryadjustments.dollars.nanos as OTHER_INVENTORY_ADJUSTMENTS_DOLLAR_NANOS,
financialPlanDetails.otherinventoryadjustments.units as OTHER_INVENTORY_ADJUSTMENTS_UNITS,
financialPlanDetails.activeopentobuycost.currencycode as ACTIVE_OPENTOBUY_COST_CURRENCY_CODE,
financialPlanDetails.activeopentobuycost.units as ACTIVE_OPENTOBUY_COST_UNITS,
financialPlanDetails.activeopentobuycost.nanos as ACTIVE_OPENTOBUY_COST_NANOS,
financialPlanDetails.inactiveopentobuycost.currencycode as INACTIVE_OPENTOBUY_COST_CURRENCY_CODE,
financialPlanDetails.inactiveopentobuycost.units as INACTIVE_OPENTOBUY_COST_UNITS,
financialPlanDetails.inactiveopentobuycost.nanos as INACTIVE_OPENTOBUY_COST_NANOS,
financialPlanDetails.activecommitmentscost.currencycode as ACTIVE_COMMITMENTS_COST_CURRENCY_CODE,
financialPlanDetails.activecommitmentscost.units as ACTIVE_COMMITMENTS_COST_UNITS,
financialPlanDetails.activecommitmentscost.nanos as ACTIVE_COMMITMENTS_COST_NANOS,
financialPlanDetails.inactivecommitmentscost.currencycode as INACTIVE_COMMITMENTS_COST_CURRENCY_CODE,
financialPlanDetails.inactivecommitmentscost.units as INACTIVE_COMMITMENTS_COST_UNITS,
financialPlanDetails.inactivecommitmentscost.nanos as INACTIVE_COMMITMENTS_COST_NANOS
from kafka_financial_country_banner_object_model_avro_extract_columns_channel;

---Writing Kafka Data to S3 in csv format for TPT load
insert into table financialcountrybanner
SELECT
 CAST(SOURCE_PUBLISH_TIME AS STRING),
 CAST(APPROVED_TIME AS STRING),
 WEEK_ID,
 DEPARTMENT_NUMBER,
 CHANNEL_COUNTRY,
 PRICING_CHANNEL,
 LAST_UPDATED_TIME_IN_MILLIS,
 FINANCIAL_PLAN_VERSION,
 ALTERNATE_INVENTORY_MODEL,
 ACTIVE_BEGINNING_INVENTORY_DOLLAR_CURRENCY_CODE,
 CAST(ACTIVE_BEGINNING_INVENTORY_DOLLAR_UNITS AS STRING),
 CAST(ACTIVE_BEGINNING_INVENTORY_DOLLAR_NANOS AS STRING),
 CAST(ACTIVE_BEGINNING_INVENTORY_UNITS AS STRING),
 CAST(ACTIVE_BEGINNING_PERIOD_INVENTORY_TARGET_UNITS AS STRING),
 INACTIVE_BEGINNING_PERIOD_INVENTORY_DOLLAR_CURRENCY_CODE,
 CAST(INACTIVE_BEGINNING_PERIOD_INVENTORY_DOLLAR_UNITS AS STRING),
 CAST(INACTIVE_BEGINNING_PERIOD_INVENTORY_DOLLAR_NANOS AS STRING),
 CAST(INACTIVE_BEGINNING_PERIOD_INVENTORY_UNITS AS STRING),
 DISCOUNT_TERMS_COST_CURRENCY_CODE,
 CAST(DISCOUNT_TERMS_COST_UNITS AS STRING),
 CAST(DISCOUNT_TERMS_COST_NANOS AS STRING),
 ACTIVE_ENDING_INVENTORY_DOLLAR_CURRENCY_CODE,
 CAST(ACTIVE_ENDING_INVENTORY_DOLLAR_UNITS AS STRING),
 CAST(ACTIVE_ENDING_INVENTORY_DOLLAR_NANOS AS STRING),
 CAST(ACTIVE_ENDING_INVENTORY_UNITS AS STRING),
 INACTIVE_ENDING_INVENTORY_DOLLAR_CURRENCY_CODE,
 CAST(INACTIVE_ENDING_INVENTORY_DOLLAR_UNITS AS STRING),
 CAST(INACTIVE_ENDING_INVENTORY_DOLLAR_NANOS AS STRING),
 CAST(INACTIVE_ENDING_INVENTORY_UNITS AS STRING),
 ACTIVE_INVENTORY_IN_DOLLAR_CURRENCY_CODE,
 CAST(ACTIVE_INVENTORY_IN_DOLLAR_UNITS AS STRING),
 CAST(ACTIVE_INVENTORY_IN_DOLLAR_NANOS AS STRING),
 CAST(ACTIVE_INVENTORY_IN_UNITS AS STRING),
 ACTIVE_INVENTORY_OUT_DOLLAR_CURRENCY_CODE,
 CAST(ACTIVE_INVENTORY_OUT_DOLLAR_UNITS AS STRING),
 CAST(ACTIVE_INVENTORY_OUT_DOLLAR_NANOS AS STRING),
 CAST(ACTIVE_INVENTORY_OUT_UNITS AS STRING),
 INACTIVE_INVENTORY_IN_DOLLAR_CURRENCY_CODE,
 CAST(INACTIVE_INVENTORY_IN_DOLLAR_UNITS AS STRING),
 CAST(INACTIVE_INVENTORY_IN_DOLLAR_NANOS AS STRING),
 CAST(INACTIVE_INVENTORY_IN_UNITS AS STRING),
 INACTIVE_INVENTORY_OUT_DOLLAR_CURRENCY_CODE,
 CAST(INACTIVE_INVENTORY_OUT_DOLLAR_UNITS AS STRING),
 CAST(INACTIVE_INVENTORY_OUT_DOLLAR_NANOS AS STRING),
 CAST(INACTIVE_INVENTORY_OUT_UNITS AS STRING),
 OTHER_INVENTORY_IN_DOLLAR_CURRENCY_CODE,
 CAST(OTHER_INVENTORY_IN_DOLLAR_UNITS AS STRING),
 CAST(OTHER_INVENTORY_IN_DOLLAR_NANOS AS STRING),
 CAST(OTHER_INVENTORY_IN_UNITS AS STRING),
 OTHER_INVENTORY_OUT_DOLLAR_CURRENCY_CODE,
 CAST(OTHER_INVENTORY_OUT_DOLLAR_UNITS AS STRING),
 CAST(OTHER_INVENTORY_OUT_DOLLAR_NANOS AS STRING),
 CAST(OTHER_INVENTORY_OUT_UNITS AS STRING),
 RACKING_IN_DOLLAR_CURRENCY_CODE,
 CAST(RACKING_IN_DOLLAR_UNITS AS STRING),
 CAST(RACKING_IN_DOLLAR_NANOS AS STRING),
 CAST(RACKING_IN_UNITS AS STRING),
 RACKING_OUT_DOLLAR_CURRENCY_CODE,
 CAST(RACKING_OUT_DOLLAR_UNITS AS STRING),
 CAST(RACKING_OUT_DOLLAR_NANOS AS STRING),
 CAST(RACKING_OUT_UNITS AS STRING),
 MERCH_MARGIN_RETAIL_CURRENCY_CODE,
 CAST(MERCH_MARGIN_RETAIL_UNITS AS STRING),
 CAST(MERCH_MARGIN_RETAIL_NANOS AS STRING),
 ACTIVE_MOS_DOLLAR_CURRENCY_CODE,
 CAST(ACTIVE_MOS_DOLLAR_UNITS AS STRING),
 CAST(ACTIVE_MOS_DOLLAR_NANOS AS STRING),
 CAST(ACTIVE_MOS_UNITS AS STRING),
 INACTIVE_MOS_DOLLAR_CURRENCY_CODE,
 CAST(INACTIVE_MOS_DOLLAR_UNITS AS STRING),
 CAST(INACTIVE_MOS_DOLLAR_NANOS AS STRING),
 CAST(INACTIVE_MOS_UNITS AS STRING),
 ACTIVE_RECEIPTS_DOLLAR_CURRENCY_CODE,
 CAST(ACTIVE_RECEIPTS_DOLLAR_UNITS AS STRING),
 CAST(ACTIVE_RECEIPTS_DOLLAR_NANOS AS STRING),
 CAST(ACTIVE_RECEIPTS_UNITS AS STRING),
 INACTIVE_RECEIPTS_DOLLAR_CURRENCY_CODE,
 CAST(INACTIVE_RECEIPTS_DOLLAR_UNITS AS STRING),
 CAST(INACTIVE_RECEIPTS_DOLLAR_NANOS AS STRING),
 CAST(INACTIVE_RECEIPTS_UNITS AS STRING),
 RESERVE_RECEIPTS_DOLLAR_CURRENCY_CODE,
 CAST(RESERVE_RECEIPTS_DOLLAR_UNITS AS STRING),
 CAST(RESERVE_RECEIPTS_DOLLAR_NANOS AS STRING),
 CAST(RESERVE_RECEIPTS_UNITS AS STRING),
 RECLASS_IN_DOLLAR_CURRENCY_CODE,
 CAST(RECLASS_IN_DOLLAR_UNITS AS STRING),
 CAST(RECLASS_IN_DOLLAR_NANOS AS STRING),
 CAST(RECLASS_IN_UNITS AS STRING),
 RECLASS_OUT_DOLLAR_CURRENCY_CODE,
 CAST(RECLASS_OUT_DOLLAR_UNITS AS STRING),
 CAST(RECLASS_OUT_DOLLAR_NANOS AS STRING),
 CAST(RECLASS_OUT_UNITS AS STRING),
 ACTIVE_RTV_DOLLAR_CURRENCY_CODE,
 CAST(ACTIVE_RTV_DOLLAR_UNITS AS STRING),
 CAST(ACTIVE_RTV_DOLLAR_NANOS AS STRING),
 CAST(ACTIVE_RTV_UNITS AS STRING),
 INACTIVE_RTV_DOLLAR_CURRENCY_CODE,
 CAST(INACTIVE_RTV_DOLLAR_UNITS AS STRING),
 CAST(INACTIVE_RTV_DOLLAR_NANOS AS STRING),
 CAST(INACTIVE_RTV_UNITS AS STRING),
 VENDOR_FUNDS_COST_CURRENCY_CODE,
 CAST(VENDOR_FUNDS_COST_UNITS AS STRING),
 CAST(VENDOR_FUNDS_COST_NANOS AS STRING),
 INVENTORY_MOVEMENT_DROP_SHIP_IN_DOLLAR_CURRENCY_CODE,
 CAST(INVENTORY_MOVEMENT_DROP_SHIP_IN_DOLLAR_UNITS AS STRING),
 CAST(INVENTORY_MOVEMENT_DROP_SHIP_IN_DOLLAR_NANOS AS STRING),
 CAST(INVENTORY_MOVEMENT_DROP_SHIP_IN_UNITS AS STRING),
 INVENTORY_MOVEMENT_DROP_SHIP_OUT_DOLLAR_CURRENCY_CODE,
 CAST(INVENTORY_MOVEMENT_DROP_SHIP_OUT_DOLLAR_UNITS AS STRING),
 CAST(INVENTORY_MOVEMENT_DROP_SHIP_OUT_DOLLAR_NANOS AS STRING),
 CAST(INVENTORY_MOVEMENT_DROP_SHIP_OUT_UNITS AS STRING),
 OTHER_INVENTORY_ADJUSTMENTS_DOLLAR_CURRENCY_CODE,
 CAST(OTHER_INVENTORY_ADJUSTMENTS_DOLLAR_UNITS AS STRING),
 CAST(OTHER_INVENTORY_ADJUSTMENTS_DOLLAR_NANOS AS STRING),
 CAST(OTHER_INVENTORY_ADJUSTMENTS_UNITS AS STRING),
 ACTIVE_OPENTOBUY_COST_CURRENCY_CODE,
 CAST(CASE
    WHEN ACTIVE_OPENTOBUY_COST_UNITS is null THEN 0 ELSE ACTIVE_OPENTOBUY_COST_UNITS
END AS STRING) AS ACTIVE_OPENTOBUY_COST_UNITS,
 CAST(CASE
    WHEN ACTIVE_OPENTOBUY_COST_NANOS is null THEN 0 ELSE ACTIVE_OPENTOBUY_COST_NANOS
END AS STRING) AS ACTIVE_OPENTOBUY_COST_NANOS,
INACTIVE_OPENTOBUY_COST_CURRENCY_CODE,
 CAST(CASE
    WHEN INACTIVE_OPENTOBUY_COST_UNITS is null THEN 0 ELSE INACTIVE_OPENTOBUY_COST_UNITS
END AS STRING) AS INACTIVE_OPENTOBUY_COST_UNITS,
 CAST(CASE
    WHEN INACTIVE_OPENTOBUY_COST_NANOS is null THEN 0 ELSE INACTIVE_OPENTOBUY_COST_NANOS
END AS STRING) AS INACTIVE_OPENTOBUY_COST_NANOS,
ACTIVE_COMMITMENTS_COST_CURRENCY_CODE,
 CAST(CASE
    WHEN ACTIVE_COMMITMENTS_COST_UNITS is null THEN 0 ELSE ACTIVE_COMMITMENTS_COST_UNITS
END AS STRING) AS ACTIVE_COMMITMENTS_COST_UNITS,
 CAST(CASE
    WHEN ACTIVE_COMMITMENTS_COST_NANOS is null THEN 0 ELSE ACTIVE_COMMITMENTS_COST_NANOS
END AS STRING) AS ACTIVE_COMMITMENTS_COST_NANOS,
INACTIVE_COMMITMENTS_COST_CURRENCY_CODE,
 CAST(CASE
    WHEN INACTIVE_COMMITMENTS_COST_UNITS is null THEN 0 ELSE INACTIVE_COMMITMENTS_COST_UNITS
END AS STRING) AS INACTIVE_COMMITMENTS_COST_UNITS,
 CAST(CASE
    WHEN INACTIVE_COMMITMENTS_COST_NANOS is null THEN 0 ELSE INACTIVE_COMMITMENTS_COST_NANOS
END AS STRING) AS INACTIVE_COMMITMENTS_COST_NANOS,
 CAST(DW_SYS_LOAD_TMSTP AS STRING)
FROM (SELECT *, current_timestamp as DW_SYS_LOAD_TMSTP,
 rank() over (PARTITION BY WEEK_ID, DEPARTMENT_NUMBER, CHANNEL_COUNTRY, PRICING_CHANNEL
  ORDER BY LAST_UPDATED_TIME_IN_MILLIS DESC) as
ranking FROM kafka_financial_country_banner_object_model_avro_extract_columns) tmp where ranking == 1;