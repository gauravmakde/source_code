TRUNCATE TABLE `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_fct.mfp_cost_plan_actual_channel_fact;


INSERT INTO `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_fct.mfp_cost_plan_actual_channel_fact 
(
 dept_num, 
 week_num, 
 channel_num, 
 fulfill_type_num, 
 cp_demand_flash_retail_amt, 
 cp_demand_persistent_retail_amt, 
 cp_demand_total_qty, 
 cp_demand_total_retail_amt,
 cp_gross_margin_retail_amt, 
 cp_gross_sales_retail_amt, 
 cp_gross_sales_qty, 
 cp_net_sales_retail_amt, 
 cp_net_sales_qty,
 cp_net_sales_cost_amt, 
 cp_net_sales_trunk_club_retail_amt, 
 cp_net_sales_trunk_club_qty, 
 cp_returns_retail_amt,
 cp_returns_qty, 
 cp_shrink_cost_amt, 
 cp_shrink_qty, 
 op_demand_flash_retail_amt, 
 op_demand_persistent_retail_amt,
 op_demand_total_qty, 
 op_demand_total_retail_amt, 
 op_gross_margin_retail_amt, 
 op_gross_sales_retail_amt,
 op_gross_sales_qty, 
 op_net_sales_retail_amt, 
 op_net_sales_qty, 
 op_net_sales_cost_amt,
 op_net_sales_trunk_club_retail_amt, 
 op_net_sales_trunk_club_qty, 
 op_returns_retail_amt, 
 op_returns_qty,
 op_shrink_cost_amt, 
 op_shrink_qty, 
 sp_demand_flash_retail_amt, 
 sp_demand_persistent_retail_amt, 
 sp_demand_total_qty,
 sp_demand_total_retail_amt, 
 sp_gross_margin_retail_amt, 
 sp_gross_sales_retail_amt, 
 sp_gross_sales_qty,
 sp_net_sales_retail_amt, 
 sp_net_sales_qty, 
 sp_net_sales_cost_amt, 
 sp_net_sales_trunk_club_retail_amt,
 sp_net_sales_trunk_club_qty, 
 sp_returns_retail_amt, 
 sp_returns_qty, 
 sp_shrink_cost_amt, 
 sp_shrink_qty,
 ty_demand_flash_retail_amt, 
 ty_demand_persistent_retail_amt, 
 ty_demand_total_qty, 
 ty_demand_total_retail_amt,
 ty_gross_margin_retail_amt, 
 ty_gross_sales_retail_amt, 
 ty_gross_sales_qty, 
 ty_net_sales_retail_amt, 
 ty_net_sales_qty,
 ty_net_sales_cost_amt, 
 ty_net_sales_trunk_club_retail_amt, 
 ty_net_sales_trunk_club_qty, 
 ty_returns_retail_amt,
 ty_returns_qty, 
 ty_shrink_cost_amt, 
 ty_shrink_qty, 
 ly_demand_flash_retail_amt, 
 ly_demand_persistent_retail_amt,
 ly_demand_total_qty, 
 ly_demand_total_retail_amt, 
 ly_gross_margin_retail_amt, 
 ly_gross_sales_retail_amt,
 ly_gross_sales_qty, 
 ly_net_sales_retail_amt, 
 ly_net_sales_qty, 
 ly_net_sales_cost_amt,
 ly_net_sales_trunk_club_retail_amt, 
 ly_net_sales_trunk_club_qty, 
 ly_returns_retail_amt, 
 ly_returns_qty,
 ly_shrink_cost_amt, 
 ly_shrink_qty, 
 lly_demand_flash_retail_amt, 
 lly_demand_persistent_retail_amt, 
 lly_demand_total_qty, 
 lly_demand_total_retail_amt, 
 lly_gross_margin_retail_amt, 
 lly_gross_sales_retail_amt, 
 lly_gross_sales_qty,
 lly_net_sales_retail_amt, 
 lly_net_sales_qty, 
 lly_net_sales_cost_amt, 
 lly_net_sales_trunk_club_retail_amt,
 lly_net_sales_trunk_club_qty, 
 lly_returns_retail_amt, 
 lly_returns_qty, 
 lly_shrink_cost_amt, 
 lly_shrink_qty,
 ly_trueday_demand_flash_retail_amt, 
 ly_trueday_demand_persistent_retail_amt, 
 ly_trueday_demand_total_qty,
 ly_trueday_demand_total_retail_amt, 
 ly_trueday_gross_margin_retail_amt, 
 ly_trueday_gross_sales_retail_amt,
 ly_trueday_gross_sales_qty, 
 ly_trueday_net_sales_retail_amt, 
 ly_trueday_net_sales_qty, 
 ly_trueday_net_sales_cost_amt,
 ly_trueday_net_sales_trunk_club_retail_amt, 
 ly_trueday_net_sales_trunk_club_qty, 
 ly_trueday_returns_retail_amt,
 ly_trueday_returns_qty, 
 ly_trueday_shrink_cost_amt, 
 ly_trueday_shrink_qty, 
 lly_trueday_demand_flash_retail_amt,
 lly_trueday_demand_persistent_retail_amt, 
 lly_trueday_demand_total_qty, 
 lly_trueday_demand_total_retail_amt,
 lly_trueday_gross_margin_retail_amt, 
 lly_trueday_gross_sales_retail_amt, 
 lly_trueday_gross_sales_qty,
 lly_trueday_net_sales_retail_amt, 
 lly_trueday_net_sales_qty, 
 lly_trueday_net_sales_cost_amt,
 lly_trueday_net_sales_trunk_club_retail_amt, 
 lly_trueday_net_sales_trunk_club_qty, 
 lly_trueday_returns_retail_amt,
 lly_trueday_returns_qty, 
 lly_trueday_shrink_cost_amt, 
 lly_trueday_shrink_qty, 
 dw_batch_date, 
 dw_sys_load_tmstp)
(SELECT dept_num,
  week_num,
  channel_num,
  fulfill_type_num,
  SUM(cp_demand_flash_retail_amt),
  SUM(cp_demand_persistent_retail_amt),
  SUM(cp_demand_total_qty),
  SUM(cp_demand_total_retail_amt),
  SUM(cp_gross_margin_retail_amt),
  SUM(cp_gross_sales_retail_amt),
  SUM(cp_gross_sales_qty),
  SUM(cp_net_sales_retail_amt),
  SUM(cp_net_sales_qty),
  SUM(cp_net_sales_cost_amt),
  SUM(cp_net_sales_trunk_club_retail_amt),
  SUM(cp_net_sales_trunk_club_qty),
  SUM(cp_returns_retail_amt),
  SUM(cp_returns_qty),
  SUM(cp_shrink_cost_amt),
  SUM(cp_shrink_qty),
  SUM(op_demand_flash_retail_amt),
  SUM(op_demand_persistent_retail_amt),
  SUM(op_demand_total_qty),
  SUM(op_demand_total_retail_amt),
  SUM(op_gross_margin_retail_amt),
  SUM(op_gross_sales_retail_amt),
  SUM(op_gross_sales_qty),
  SUM(op_net_sales_retail_amt),
  SUM(op_net_sales_qty),
  SUM(op_net_sales_cost_amt),
  SUM(op_net_sales_trunk_club_retail_amt),
  SUM(op_net_sales_trunk_club_qty),
  SUM(op_returns_retail_amt),
  SUM(op_returns_qty),
  SUM(op_shrink_cost_amt),
  SUM(op_shrink_qty),
  SUM(sp_demand_flash_retail_amt),
  SUM(sp_demand_persistent_retail_amt),
  SUM(sp_demand_total_qty),
  SUM(sp_demand_total_retail_amt),
  SUM(sp_gross_margin_retail_amt),
  SUM(sp_gross_sales_retail_amt),
  SUM(sp_gross_sales_qty),
  SUM(sp_net_sales_retail_amt),
  SUM(sp_net_sales_qty),
  SUM(sp_net_sales_cost_amt),
  SUM(sp_net_sales_trunk_club_retail_amt),
  SUM(sp_net_sales_trunk_club_qty),
  SUM(sp_returns_retail_amt),
  SUM(sp_returns_qty),
  SUM(sp_shrink_cost_amt),
  SUM(sp_shrink_qty),
  SUM(ty_demand_flash_retail_amt),
  SUM(ty_demand_persistent_retail_amt),
  SUM(ty_demand_total_qty),
  SUM(ty_demand_total_retail_amt),
  SUM(ty_gross_margin_retail_amt),
  SUM(ty_gross_sales_retail_amt),
  SUM(ty_gross_sales_qty),
  SUM(ty_net_sales_retail_amt),
  SUM(ty_net_sales_qty),
  SUM(ty_net_sales_cost_amt),
  SUM(ty_net_sales_trunk_club_retail_amt),
  SUM(ty_net_sales_trunk_club_qty),
  SUM(ty_returns_retail_amt),
  SUM(ty_returns_qty),
  SUM(ty_shrink_cost_amt),
  SUM(ty_shrink_qty),
  SUM(ly_demand_flash_retail_amt),
  SUM(ly_demand_persistent_retail_amt),
  SUM(ly_demand_total_qty),
  SUM(ly_demand_total_retail_amt),
  SUM(ly_gross_margin_retail_amt),
  SUM(ly_gross_sales_retail_amt),
  SUM(ly_gross_sales_qty),
  SUM(ly_net_sales_retail_amt),
  SUM(ly_net_sales_qty),
  SUM(ly_net_sales_cost_amt),
  SUM(ly_net_sales_trunk_club_retail_amt),
  SUM(ly_net_sales_trunk_club_qty),
  SUM(ly_returns_retail_amt),
  SUM(ly_returns_qty),
  SUM(ly_shrink_cost_amt),
  SUM(ly_shrink_qty),
  SUM(lly_demand_flash_retail_amt),
  SUM(lly_demand_persistent_retail_amt),
  SUM(lly_demand_total_qty),
  SUM(lly_demand_total_retail_amt),
  SUM(lly_gross_margin_retail_amt),
  SUM(lly_gross_sales_retail_amt),
  SUM(lly_gross_sales_qty),
  SUM(lly_net_sales_retail_amt),
  SUM(lly_net_sales_qty),
  SUM(lly_net_sales_cost_amt),
  SUM(lly_net_sales_trunk_club_retail_amt),
  SUM(lly_net_sales_trunk_club_qty),
  SUM(lly_returns_retail_amt),
  SUM(lly_returns_qty),
  SUM(lly_shrink_cost_amt),
  SUM(lly_shrink_qty),
  SUM(ly_trueday_demand_flash_retail_amt),
  SUM(ly_trueday_demand_persistent_retail_amt),
  SUM(ly_trueday_demand_total_qty),
  SUM(ly_trueday_demand_total_retail_amt),
  SUM(ly_trueday_gross_margin_retail_amt),
  SUM(ly_trueday_gross_sales_retail_amt),
  SUM(ly_trueday_gross_sales_qty),
  SUM(ly_trueday_net_sales_retail_amt),
  SUM(ly_trueday_net_sales_qty),
  SUM(ly_trueday_net_sales_cost_amt),
  SUM(ly_trueday_net_sales_trunk_club_retail_amt),
  SUM(ly_trueday_net_sales_trunk_club_qty),
  SUM(ly_trueday_returns_retail_amt),
  SUM(ly_trueday_returns_qty),
  SUM(ly_trueday_shrink_cost_amt),
  SUM(ly_trueday_shrink_qty),
  SUM(lly_trueday_demand_flash_retail_amt),
  SUM(lly_trueday_demand_persistent_retail_amt),
  SUM(lly_trueday_demand_total_qty),
  SUM(lly_trueday_demand_total_retail_amt),
  SUM(lly_trueday_gross_margin_retail_amt),
  SUM(lly_trueday_gross_sales_retail_amt),
  SUM(lly_trueday_gross_sales_qty),
  SUM(lly_trueday_net_sales_retail_amt),
  SUM(lly_trueday_net_sales_qty),
  SUM(lly_trueday_net_sales_cost_amt),
  SUM(lly_trueday_net_sales_trunk_club_retail_amt),
  SUM(lly_trueday_net_sales_trunk_club_qty),
  SUM(lly_trueday_returns_retail_amt),
  SUM(lly_trueday_returns_qty),
  SUM(lly_trueday_shrink_cost_amt),
  SUM(lly_trueday_shrink_qty),
  MAX(dw_batch_date),
  CAST(FORMAT_TIMESTAMP('%F %H:%M:%E6S', CURRENT_DATETIME('PST8PDT')) AS DATETIME) AS dw_sys_load_tmstp
 FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_stg.mfp_cost_plan_actual_channel_wrk
 GROUP BY dept_num,
  week_num,
  channel_num,
  fulfill_type_num);