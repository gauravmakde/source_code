

CREATE TEMPORARY TABLE IF NOT EXISTS mfp_banner_country_plans
-- CLUSTER BY snapshot_plan_month_idnt, week_num, dept_num, banner_country_num
AS
SELECT cal.month_idnt AS snapshot_plan_month_idnt,
 cal.month_start_day_date AS snapshot_start_day_date,
 p.dept_num,
 p.week_num,
 p.banner_country_num,
 p.fulfill_type_num,
 p.cp_beginning_of_period_active_cost_amt,
 p.cp_beginning_of_period_active_inventory_target_qty,
 p.cp_beginning_of_period_active_qty,
 p.cp_beginning_of_period_inactive_cost_amt,
 p.cp_beginning_of_period_inactive_qty,
 p.cp_ending_of_period_active_cost_amt,
 p.cp_ending_of_period_active_qty,
 p.cp_ending_of_period_inactive_cost_amt,
 p.cp_ending_of_period_inactive_qty,
 p.cp_transfer_in_active_cost_amt,
 p.cp_transfer_in_active_qty,
 p.cp_transfer_out_active_cost_amt,
 p.cp_transfer_out_active_qty,
 p.cp_transfer_in_inactive_cost_amt,
 p.cp_transfer_in_inactive_qty,
 p.cp_transfer_out_inactive_cost_amt,
 p.cp_transfer_out_inactive_qty,
 p.cp_transfer_in_other_cost_amt,
 p.cp_transfer_in_other_qty,
 p.cp_transfer_out_other_cost_amt,
 p.cp_transfer_out_other_qty,
 p.cp_transfer_in_racking_cost_amt,
 p.cp_transfer_in_racking_qty,
 p.cp_transfer_out_racking_cost_amt,
 p.cp_transfer_out_racking_qty,
 p.cp_mark_out_of_stock_active_cost_amt,
 p.cp_mark_out_of_stock_active_qty,
 p.cp_mark_out_of_stock_inactive_cost_amt,
 p.cp_mark_out_of_stock_inactive_qty,
 p.cp_receipts_active_cost_amt,
 p.cp_receipts_active_qty,
 p.cp_receipts_inactive_cost_amt,
 p.cp_receipts_inactive_qty,
 p.cp_receipts_reserve_cost_amt,
 p.cp_receipts_reserve_qty,
 p.cp_reclass_in_cost_amt,
 p.cp_reclass_in_qty,
 p.cp_reclass_out_cost_amt,
 p.cp_reclass_out_qty,
 p.cp_return_to_vendor_active_cost_amt,
 p.cp_return_to_vendor_active_qty,
 p.cp_return_to_vendor_inactive_cost_amt,
 p.cp_return_to_vendor_inactive_qty,
 p.cp_vendor_funds_cost_amt,
 p.cp_discount_terms_cost_amt,
 p.cp_merch_margin_retail_amt,
 p.cp_inventory_movement_in_dropship_cost_amt,
 p.cp_inventory_movement_in_dropship_qty,
 p.cp_inventory_movement_out_dropship_cost_amt,
 p.cp_inventory_movement_out_dropship_qty,
 p.cp_other_inventory_adjustment_cost_amt,
 p.cp_other_inventory_adjustment_qty,
 p.cp_open_to_buy_receipts_active_cost_amt,
 p.cp_open_to_buy_receipts_inactive_cost_amt,
 p.op_beginning_of_period_active_cost_amt,
 p.op_beginning_of_period_active_inventory_target_qty,
 p.op_beginning_of_period_active_qty,
 p.op_beginning_of_period_inactive_cost_amt,
 p.op_beginning_of_period_inactive_qty,
 p.op_ending_of_period_active_cost_amt,
 p.op_ending_of_period_active_qty,
 p.op_ending_of_period_inactive_cost_amt,
 p.op_ending_of_period_inactive_qty,
 p.op_transfer_in_active_cost_amt,
 p.op_transfer_in_active_qty,
 p.op_transfer_out_active_cost_amt,
 p.op_transfer_out_active_qty,
 p.op_transfer_in_inactive_cost_amt,
 p.op_transfer_in_inactive_qty,
 p.op_transfer_out_inactive_cost_amt,
 p.op_transfer_out_inactive_qty,
 p.op_transfer_in_other_cost_amt,
 p.op_transfer_in_other_qty,
 p.op_transfer_out_other_cost_amt,
 p.op_transfer_out_other_qty,
 p.op_transfer_in_racking_cost_amt,
 p.op_transfer_in_racking_qty,
 p.op_transfer_out_racking_cost_amt,
 p.op_transfer_out_racking_qty,
 p.op_mark_out_of_stock_active_cost_amt,
 p.op_mark_out_of_stock_active_qty,
 p.op_mark_out_of_stock_inactive_cost_amt,
 p.op_mark_out_of_stock_inactive_qty,
 p.op_receipts_active_cost_amt,
 p.op_receipts_active_qty,
 p.op_receipts_inactive_cost_amt,
 p.op_receipts_inactive_qty,
 p.op_receipts_reserve_cost_amt,
 p.op_receipts_reserve_qty,
 p.op_reclass_in_cost_amt,
 p.op_reclass_in_qty,
 p.op_reclass_out_cost_amt,
 p.op_reclass_out_qty,
 p.op_return_to_vendor_active_cost_amt,
 p.op_return_to_vendor_active_qty,
 p.op_return_to_vendor_inactive_cost_amt,
 p.op_return_to_vendor_inactive_qty,
 p.op_vendor_funds_cost_amt,
 p.op_discount_terms_cost_amt,
 p.op_merch_margin_retail_amt,
 p.op_inventory_movement_in_dropship_cost_amt,
 p.op_inventory_movement_in_dropship_qty,
 p.op_inventory_movement_out_dropship_cost_amt,
 p.op_inventory_movement_out_dropship_qty,
 p.op_other_inventory_adjustment_cost_amt,
 p.op_other_inventory_adjustment_qty,
 p.sp_beginning_of_period_active_cost_amt,
 p.sp_beginning_of_period_active_inventory_target_qty,
 p.sp_beginning_of_period_active_qty,
 p.sp_beginning_of_period_inactive_cost_amt,
 p.sp_beginning_of_period_inactive_qty,
 p.sp_ending_of_period_active_cost_amt,
 p.sp_ending_of_period_active_qty,
 p.sp_ending_of_period_inactive_cost_amt,
 p.sp_ending_of_period_inactive_qty,
 p.sp_transfer_in_active_cost_amt,
 p.sp_transfer_in_active_qty,
 p.sp_transfer_out_active_cost_amt,
 p.sp_transfer_out_active_qty,
 p.sp_transfer_in_inactive_cost_amt,
 p.sp_transfer_in_inactive_qty,
 p.sp_transfer_out_inactive_cost_amt,
 p.sp_transfer_out_inactive_qty,
 p.sp_transfer_in_other_cost_amt,
 p.sp_transfer_in_other_qty,
 p.sp_transfer_out_other_cost_amt,
 p.sp_transfer_out_other_qty,
 p.sp_transfer_in_racking_cost_amt,
 p.sp_transfer_in_racking_qty,
 p.sp_transfer_out_racking_cost_amt,
 p.sp_transfer_out_racking_qty,
 p.sp_mark_out_of_stock_active_cost_amt,
 p.sp_mark_out_of_stock_active_qty,
 p.sp_mark_out_of_stock_inactive_cost_amt,
 p.sp_mark_out_of_stock_inactive_qty,
 p.sp_receipts_active_cost_amt,
 p.sp_receipts_active_qty,
 p.sp_receipts_inactive_cost_amt,
 p.sp_receipts_inactive_qty,
 p.sp_receipts_reserve_cost_amt,
 p.sp_receipts_reserve_qty,
 p.sp_reclass_in_cost_amt,
 p.sp_reclass_in_qty,
 p.sp_reclass_out_cost_amt,
 p.sp_reclass_out_qty,
 p.sp_return_to_vendor_active_cost_amt,
 p.sp_return_to_vendor_active_qty,
 p.sp_return_to_vendor_inactive_cost_amt,
 p.sp_return_to_vendor_inactive_qty,
 p.sp_vendor_funds_cost_amt,
 p.sp_discount_terms_cost_amt,
 p.sp_merch_margin_retail_amt,
 p.sp_inventory_movement_in_dropship_cost_amt,
 p.sp_inventory_movement_in_dropship_qty,
 p.sp_inventory_movement_out_dropship_cost_amt,
 p.sp_inventory_movement_out_dropship_qty,
 p.sp_other_inventory_adjustment_cost_amt,
 p.sp_other_inventory_adjustment_qty,
 p.sp_open_to_buy_receipts_active_cost_amt,
 p.sp_open_to_buy_receipts_inactive_cost_amt,
 p.dw_batch_date,
 p.dw_sys_load_tmstp,
 CAST( CURRENT_DATETIME('PST8PDT') AS Timestamp) AS rcd_update_timestamp,
  `{{params.gcp_project_id}}`.JWN_UDF.DEFAULT_TZ_PST() as rcd_update_timestamp_tz
FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_vws.mfp_cost_plan_actual_banner_country_fact AS p
 INNER JOIN `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_usr_vws.day_cal_454_dim AS cal ON CURRENT_DATE('PST8PDT') = cal.day_date
WHERE p.week_num >= (SELECT DISTINCT week_idnt
   FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_usr_vws.day_cal_454_dim
   WHERE day_date = CURRENT_DATE('PST8PDT'));


DELETE FROM `{{params.gcp_project_id}}`.{{params.environment_schema}}.mfp_cost_plan_actual_banner_country_history{{params.env_suffix}}
WHERE snapshot_plan_month_idnt = (SELECT DISTINCT month_idnt
  FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_usr_vws.day_cal_454_dim
  WHERE day_date = CURRENT_DATE('PST8PDT'));


INSERT INTO `{{params.gcp_project_id}}`.{{params.environment_schema}}.mfp_cost_plan_actual_banner_country_history{{params.env_suffix}}
(SELECT snapshot_plan_month_idnt,
  snapshot_start_day_date,
  dept_num,
  week_num,
  banner_country_num,
  fulfill_type_num,
  cp_beginning_of_period_active_cost_amt,
  cp_beginning_of_period_active_inventory_target_qty,
  cp_beginning_of_period_active_qty,
  cp_beginning_of_period_inactive_cost_amt,
  cp_beginning_of_period_inactive_qty,
  cp_ending_of_period_active_cost_amt,
  cp_ending_of_period_active_qty,
  cp_ending_of_period_inactive_cost_amt,
  cp_ending_of_period_inactive_qty,
  cp_transfer_in_active_cost_amt,
  cp_transfer_in_active_qty,
  cp_transfer_out_active_cost_amt,
  cp_transfer_out_active_qty,
  cp_transfer_in_inactive_cost_amt,
  cp_transfer_in_inactive_qty,
  cp_transfer_out_inactive_cost_amt,
  cp_transfer_out_inactive_qty,
  cp_transfer_in_other_cost_amt,
  cp_transfer_in_other_qty,
  cp_transfer_out_other_cost_amt,
  cp_transfer_out_other_qty,
  cp_transfer_in_racking_cost_amt,
  cp_transfer_in_racking_qty,
  cp_transfer_out_racking_cost_amt,
  cp_transfer_out_racking_qty,
  cp_mark_out_of_stock_active_cost_amt,
  cp_mark_out_of_stock_active_qty,
  cp_mark_out_of_stock_inactive_cost_amt,
  cp_mark_out_of_stock_inactive_qty,
  cp_receipts_active_cost_amt,
  cp_receipts_active_qty,
  cp_receipts_inactive_cost_amt,
  cp_receipts_inactive_qty,
  cp_receipts_reserve_cost_amt,
  cp_receipts_reserve_qty,
  cp_reclass_in_cost_amt,
  cp_reclass_in_qty,
  cp_reclass_out_cost_amt,
  cp_reclass_out_qty,
  cp_return_to_vendor_active_cost_amt,
  cp_return_to_vendor_active_qty,
  cp_return_to_vendor_inactive_cost_amt,
  cp_return_to_vendor_inactive_qty,
  cp_vendor_funds_cost_amt,
  cp_discount_terms_cost_amt,
  cp_merch_margin_retail_amt,
  cp_inventory_movement_in_dropship_cost_amt,
  cp_inventory_movement_in_dropship_qty,
  cp_inventory_movement_out_dropship_cost_amt,
  cp_inventory_movement_out_dropship_qty,
  cp_other_inventory_adjustment_cost_amt,
  cp_other_inventory_adjustment_qty,
  cp_open_to_buy_receipts_active_cost_amt,
  cp_open_to_buy_receipts_inactive_cost_amt,
  op_beginning_of_period_active_cost_amt,
  op_beginning_of_period_active_inventory_target_qty,
  op_beginning_of_period_active_qty,
  op_beginning_of_period_inactive_cost_amt,
  op_beginning_of_period_inactive_qty,
  op_ending_of_period_active_cost_amt,
  op_ending_of_period_active_qty,
  op_ending_of_period_inactive_cost_amt,
  op_ending_of_period_inactive_qty,
  op_transfer_in_active_cost_amt,
  op_transfer_in_active_qty,
  op_transfer_out_active_cost_amt,
  op_transfer_out_active_qty,
  op_transfer_in_inactive_cost_amt,
  op_transfer_in_inactive_qty,
  op_transfer_out_inactive_cost_amt,
  op_transfer_out_inactive_qty,
  op_transfer_in_other_cost_amt,
  op_transfer_in_other_qty,
  op_transfer_out_other_cost_amt,
  op_transfer_out_other_qty,
  op_transfer_in_racking_cost_amt,
  op_transfer_in_racking_qty,
  op_transfer_out_racking_cost_amt,
  op_transfer_out_racking_qty,
  op_mark_out_of_stock_active_cost_amt,
  op_mark_out_of_stock_active_qty,
  op_mark_out_of_stock_inactive_cost_amt,
  op_mark_out_of_stock_inactive_qty,
  op_receipts_active_cost_amt,
  op_receipts_active_qty,
  op_receipts_inactive_cost_amt,
  op_receipts_inactive_qty,
  op_receipts_reserve_cost_amt,
  op_receipts_reserve_qty,
  op_reclass_in_cost_amt,
  op_reclass_in_qty,
  op_reclass_out_cost_amt,
  op_reclass_out_qty,
  op_return_to_vendor_active_cost_amt,
  op_return_to_vendor_active_qty,
  op_return_to_vendor_inactive_cost_amt,
  op_return_to_vendor_inactive_qty,
  op_vendor_funds_cost_amt,
  op_discount_terms_cost_amt,
  op_merch_margin_retail_amt,
  op_inventory_movement_in_dropship_cost_amt,
  op_inventory_movement_in_dropship_qty,
  op_inventory_movement_out_dropship_cost_amt,
  op_inventory_movement_out_dropship_qty,
  op_other_inventory_adjustment_cost_amt,
  op_other_inventory_adjustment_qty,
  sp_beginning_of_period_active_cost_amt,
  sp_beginning_of_period_active_inventory_target_qty,
  sp_beginning_of_period_active_qty,
  sp_beginning_of_period_inactive_cost_amt,
  sp_beginning_of_period_inactive_qty,
  sp_ending_of_period_active_cost_amt,
  sp_ending_of_period_active_qty,
  sp_ending_of_period_inactive_cost_amt,
  sp_ending_of_period_inactive_qty,
  sp_transfer_in_active_cost_amt,
  sp_transfer_in_active_qty,
  sp_transfer_out_active_cost_amt,
  sp_transfer_out_active_qty,
  sp_transfer_in_inactive_cost_amt,
  sp_transfer_in_inactive_qty,
  sp_transfer_out_inactive_cost_amt,
  sp_transfer_out_inactive_qty,
  sp_transfer_in_other_cost_amt,
  sp_transfer_in_other_qty,
  sp_transfer_out_other_cost_amt,
  sp_transfer_out_other_qty,
  sp_transfer_in_racking_cost_amt,
  sp_transfer_in_racking_qty,
  sp_transfer_out_racking_cost_amt,
  sp_transfer_out_racking_qty,
  sp_mark_out_of_stock_active_cost_amt,
  sp_mark_out_of_stock_active_qty,
  sp_mark_out_of_stock_inactive_cost_amt,
  sp_mark_out_of_stock_inactive_qty,
  sp_receipts_active_cost_amt,
  sp_receipts_active_qty,
  sp_receipts_inactive_cost_amt,
  sp_receipts_inactive_qty,
  sp_receipts_reserve_cost_amt,
  sp_receipts_reserve_qty,
  sp_reclass_in_cost_amt,
  sp_reclass_in_qty,
  sp_reclass_out_cost_amt,
  sp_reclass_out_qty,
  sp_return_to_vendor_active_cost_amt,
  sp_return_to_vendor_active_qty,
  sp_return_to_vendor_inactive_cost_amt,
  sp_return_to_vendor_inactive_qty,
  sp_vendor_funds_cost_amt,
  sp_discount_terms_cost_amt,
  sp_merch_margin_retail_amt,
  sp_inventory_movement_in_dropship_cost_amt,
  sp_inventory_movement_in_dropship_qty,
  sp_inventory_movement_out_dropship_cost_amt,
  sp_inventory_movement_out_dropship_qty,
  sp_other_inventory_adjustment_cost_amt,
  sp_other_inventory_adjustment_qty,
  sp_open_to_buy_receipts_active_cost_amt,
  sp_open_to_buy_receipts_inactive_cost_amt,
  dw_batch_date,
  dw_sys_load_tmstp,
  rcd_update_timestamp  AS rcd_update_timestamp,
  rcd_update_timestamp_tz
 FROM mfp_banner_country_plans
 WHERE snapshot_plan_month_idnt = (SELECT DISTINCT month_idnt
    FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_usr_vws.day_cal_454_dim
    WHERE day_date = CURRENT_DATE('PST8PDT')));




CREATE TEMPORARY TABLE IF NOT EXISTS mfp_channel_plans
-- CLUSTER BY snapshot_plan_month_idnt, week_num, dept_num, channel_num
AS
SELECT cal.month_idnt AS snapshot_plan_month_idnt,
 cal.month_start_day_date AS snapshot_start_day_date,
 p.dept_num,
 p.week_num,
 p.channel_num,
 p.fulfill_type_num,
 p.cp_demand_flash_retail_amt,
 p.cp_demand_persistent_retail_amt,
 p.cp_demand_total_qty,
 p.cp_demand_total_retail_amt,
 p.cp_gross_margin_retail_amt,
 p.cp_gross_sales_retail_amt,
 p.cp_gross_sales_qty,
 p.cp_net_sales_retail_amt,
 p.cp_net_sales_qty,
 p.cp_net_sales_cost_amt,
 p.cp_net_sales_trunk_club_retail_amt,
 p.cp_net_sales_trunk_club_qty,
 p.cp_returns_retail_amt,
 p.cp_returns_qty,
 p.cp_shrink_cost_amt,
 p.cp_shrink_qty,
 p.op_demand_flash_retail_amt,
 p.op_demand_persistent_retail_amt,
 p.op_demand_total_qty,
 p.op_demand_total_retail_amt,
 p.op_gross_margin_retail_amt,
 p.op_gross_sales_retail_amt,
 p.op_gross_sales_qty,
 p.op_net_sales_retail_amt,
 p.op_net_sales_qty,
 p.op_net_sales_cost_amt,
 p.op_net_sales_trunk_club_retail_amt,
 p.op_net_sales_trunk_club_qty,
 p.op_returns_retail_amt,
 p.op_returns_qty,
 p.op_shrink_cost_amt,
 p.op_shrink_qty,
 p.sp_demand_flash_retail_amt,
 p.sp_demand_persistent_retail_amt,
 p.sp_demand_total_qty,
 p.sp_demand_total_retail_amt,
 p.sp_gross_margin_retail_amt,
 p.sp_gross_sales_retail_amt,
 p.sp_gross_sales_qty,
 p.sp_net_sales_retail_amt,
 p.sp_net_sales_qty,
 p.sp_net_sales_cost_amt,
 p.sp_net_sales_trunk_club_retail_amt,
 p.sp_net_sales_trunk_club_qty,
 p.sp_returns_retail_amt,
 p.sp_returns_qty,
 p.sp_shrink_cost_amt,
 p.sp_shrink_qty,
 p.ty_demand_flash_retail_amt,
 p.ty_demand_persistent_retail_amt,
 p.ty_demand_total_qty,
 p.ty_demand_total_retail_amt,
 p.ty_gross_margin_retail_amt,
 p.ty_gross_sales_retail_amt,
 p.ty_gross_sales_qty,
 p.ty_net_sales_retail_amt,
 p.ty_net_sales_qty,
 p.ty_net_sales_cost_amt,
 p.ty_net_sales_trunk_club_retail_amt,
 p.ty_net_sales_trunk_club_qty,
 p.ty_returns_retail_amt,
 p.ty_returns_qty,
 p.ty_shrink_cost_amt,
 p.ty_shrink_qty,
 p.ly_demand_flash_retail_amt,
 p.ly_demand_persistent_retail_amt,
 p.ly_demand_total_qty,
 p.ly_demand_total_retail_amt,
 p.ly_gross_margin_retail_amt,
 p.ly_gross_sales_retail_amt,
 p.ly_gross_sales_qty,
 p.ly_net_sales_retail_amt,
 p.ly_net_sales_qty,
 p.ly_net_sales_cost_amt,
 p.ly_net_sales_trunk_club_retail_amt,
 p.ly_net_sales_trunk_club_qty,
 p.ly_returns_retail_amt,
 p.ly_returns_qty,
 p.ly_shrink_cost_amt,
 p.ly_shrink_qty,
 p.lly_demand_flash_retail_amt,
 p.lly_demand_persistent_retail_amt,
 p.lly_demand_total_qty,
 p.lly_demand_total_retail_amt,
 p.lly_gross_margin_retail_amt,
 p.lly_gross_sales_retail_amt,
 p.lly_gross_sales_qty,
 p.lly_net_sales_retail_amt,
 p.lly_net_sales_qty,
 p.lly_net_sales_cost_amt,
 p.lly_net_sales_trunk_club_retail_amt,
 p.lly_net_sales_trunk_club_qty,
 p.lly_returns_retail_amt,
 p.lly_returns_qty,
 p.lly_shrink_cost_amt,
 p.lly_shrink_qty,
 p.dw_batch_date,
 p.dw_sys_load_tmstp,
 CAST(CURRENT_DATETIME('PST8PDT') AS TIMESTAMP) AS rcd_update_timestamp,
 `{{params.gcp_project_id}}`.JWN_UDF.DEFAULT_TZ_PST() as rcd_update_timestamp_tz
FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_vws.mfp_cost_plan_actual_channel_fact AS p
 INNER JOIN `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_usr_vws.day_cal_454_dim AS cal ON CURRENT_DATE('PST8PDT') = cal.day_date
WHERE p.week_num >= (SELECT DISTINCT week_idnt
   FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_usr_vws.day_cal_454_dim
   WHERE day_date = CURRENT_DATE('PST8PDT'));


DELETE FROM `{{params.gcp_project_id}}`.{{params.environment_schema}}.mfp_cost_plan_actual_channel_history{{params.env_suffix}}
WHERE snapshot_plan_month_idnt = (SELECT DISTINCT month_idnt
  FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_usr_vws.day_cal_454_dim
  WHERE day_date = CURRENT_DATE('PST8PDT'));


INSERT INTO `{{params.gcp_project_id}}`.{{params.environment_schema}}.mfp_cost_plan_actual_channel_history{{params.env_suffix}}
(SELECT snapshot_plan_month_idnt,
  snapshot_start_day_date,
  dept_num,
  week_num,
  channel_num,
  fulfill_type_num,
  cp_demand_flash_retail_amt,
  cp_demand_persistent_retail_amt,
  cp_demand_total_qty,
  cp_demand_total_retail_amt,
  cp_gross_margin_retail_amt,
  cp_gross_sales_retail_amt,
  cp_gross_sales_qty,
  cp_net_sales_retail_amt,
  cp_net_sales_qty,
  cp_net_sales_cost_amt,
  cp_net_sales_trunk_club_retail_amt,
  cp_net_sales_trunk_club_qty,
  cp_returns_retail_amt,
  cp_returns_qty,
  cp_shrink_cost_amt,
  cp_shrink_qty,
  op_demand_flash_retail_amt,
  op_demand_persistent_retail_amt,
  op_demand_total_qty,
  op_demand_total_retail_amt,
  op_gross_margin_retail_amt,
  op_gross_sales_retail_amt,
  op_gross_sales_qty,
  op_net_sales_retail_amt,
  op_net_sales_qty,
  op_net_sales_cost_amt,
  op_net_sales_trunk_club_retail_amt,
  op_net_sales_trunk_club_qty,
  op_returns_retail_amt,
  op_returns_qty,
  op_shrink_cost_amt,
  op_shrink_qty,
  sp_demand_flash_retail_amt,
  sp_demand_persistent_retail_amt,
  sp_demand_total_qty,
  sp_demand_total_retail_amt,
  sp_gross_margin_retail_amt,
  sp_gross_sales_retail_amt,
  sp_gross_sales_qty,
  sp_net_sales_retail_amt,
  sp_net_sales_qty,
  sp_net_sales_cost_amt,
  sp_net_sales_trunk_club_retail_amt,
  sp_net_sales_trunk_club_qty,
  sp_returns_retail_amt,
  sp_returns_qty,
  sp_shrink_cost_amt,
  sp_shrink_qty,
  ty_demand_flash_retail_amt,
  ty_demand_persistent_retail_amt,
  ty_demand_total_qty,
  ty_demand_total_retail_amt,
  ty_gross_margin_retail_amt,
  ty_gross_sales_retail_amt,
  ty_gross_sales_qty,
  ty_net_sales_retail_amt,
  ty_net_sales_qty,
  ty_net_sales_cost_amt,
  ty_net_sales_trunk_club_retail_amt,
  ty_net_sales_trunk_club_qty,
  ty_returns_retail_amt,
  ty_returns_qty,
  ty_shrink_cost_amt,
  ty_shrink_qty,
  ly_demand_flash_retail_amt,
  ly_demand_persistent_retail_amt,
  ly_demand_total_qty,
  ly_demand_total_retail_amt,
  ly_gross_margin_retail_amt,
  ly_gross_sales_retail_amt,
  ly_gross_sales_qty,
  ly_net_sales_retail_amt,
  ly_net_sales_qty,
  ly_net_sales_cost_amt,
  ly_net_sales_trunk_club_retail_amt,
  ly_net_sales_trunk_club_qty,
  ly_returns_retail_amt,
  ly_returns_qty,
  ly_shrink_cost_amt,
  ly_shrink_qty,
  lly_demand_flash_retail_amt,
  lly_demand_persistent_retail_amt,
  lly_demand_total_qty,
  lly_demand_total_retail_amt,
  lly_gross_margin_retail_amt,
  lly_gross_sales_retail_amt,
  lly_gross_sales_qty,
  lly_net_sales_retail_amt,
  lly_net_sales_qty,
  lly_net_sales_cost_amt,
  lly_net_sales_trunk_club_retail_amt,
  lly_net_sales_trunk_club_qty,
  lly_returns_retail_amt,
  lly_returns_qty,
  lly_shrink_cost_amt,
  lly_shrink_qty,
  dw_batch_date,
  dw_sys_load_tmstp,
  rcd_update_timestamp,
  rcd_update_timestamp_tz
 FROM mfp_channel_plans
 WHERE snapshot_plan_month_idnt = (SELECT DISTINCT month_idnt
    FROM `{{params.gcp_project_id}}`.{{params.dbenv}}_nap_usr_vws.day_cal_454_dim
    WHERE day_date = CURRENT_DATE('PST8PDT')));